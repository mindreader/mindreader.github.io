<!DOCTYPE HTML><html><head><link href="public/highlight/styles/pojoaque.css" rel="stylesheet"><link href="public/reveal.js-3.3.0/css/reveal.css" rel="stylesheet"><link href="public/reveal.js-3.3.0/css/theme/black.css" rel="stylesheet"></head><body style="background-color: black"><div class="reveal"><div class="slides"><section class="sect"><section class="subsect"><div><h1>Pipes</h1><h4 style="margin-bottom: 40px">Practical use of Gabriel Gonzales&#39;s pipes library and ecosystem</h4><div style="font-size: 50%">David McHealy (david.mchealy@gmail.com)</div><div style="font-size: 70%">View slides online at: </div><div style="font-size: 50%">https://mindreader.github.io/pipes-slides</div></div></section></section><section class="sect"><section class="subsect"><div>Motivations</div></section><section class="subsect"><div>We&#39;re used to having composability in haskell.<pre><a name="line-1"></a>  <font color="#dccf8f">process</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">String</font>
<a name="line-2"></a>  <font color="#dccf8f">process</font> <font color="#b64926">=</font> <font color="#dccf8f">take</font> <font color="#586e75">50</font> <font color="#dccf8f">.</font> <font color="#dccf8f">reverse</font> <font color="#dccf8f">.</font> <font color="#dccf8f">drop</font> <font color="#586e75">5</font> <font color="#dccf8f">.</font> <font color="#dccf8f">map</font> <font color="#dccf8f">toLower</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">main</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">main</font> <font color="#b64926">=</font> <font color="#dccf8f">readFile</font> <font color="#586e75">"input.txt"</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">writeFile</font> <font color="#586e75">"output.txt"</font>
<a name="line-3"></a>    <font color="#b64926">where</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">content</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">main</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">main</font> <font color="#b64926">=</font> <font color="#dccf8f">readFile</font> <font color="#586e75">"input.txt"</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">writeFile</font> <font color="#586e75">"output.txt"</font>
<a name="line-3"></a>    <font color="#b64926">where</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">content</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div><div>This technically works, but memory is unbounded.</div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">main</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">main</font> <font color="#b64926">=</font> <font color="#dccf8f">forM_</font> <font color="#b64926">[</font><font color="#586e75">1</font><font color="#b64926">..</font><font color="#586e75">10000</font><font color="#b64926">]</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">i</font> <font color="#b64926">-&gt;</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#b64926">let</font> <font color="#dccf8f">(</font><font color="#dccf8f">inf</font><font color="#dccf8f">,</font><font color="#dccf8f">outf</font><font color="#dccf8f">)</font> <font color="#b64926">=</font> <font color="#dccf8f">(</font><font color="#586e75">"input"</font> <font color="#dccf8f">++</font> <font color="#dccf8f">show</font> <font color="#dccf8f">i</font> <font color="#dccf8f">++</font> <font color="#586e75">".txt"</font><font color="#dccf8f">,</font> <font color="#586e75">"output"</font> <font color="#dccf8f">++</font> <font color="#dccf8f">show</font> <font color="#dccf8f">i</font> <font color="#dccf8f">++</font> <font color="#586e75">".txt"</font><font color="#dccf8f">)</font>
<a name="line-4"></a>    <font color="#dccf8f">readFile</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">writeFile</font> <font color="#dccf8f">outf</font>
<a name="line-5"></a>    <font color="#b64926">where</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">content</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">main</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">main</font> <font color="#b64926">=</font> <font color="#dccf8f">forM_</font> <font color="#b64926">[</font><font color="#586e75">1</font><font color="#b64926">..</font><font color="#586e75">10000</font><font color="#b64926">]</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">i</font> <font color="#b64926">-&gt;</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#b64926">let</font> <font color="#dccf8f">(</font><font color="#dccf8f">inf</font><font color="#dccf8f">,</font><font color="#dccf8f">outf</font><font color="#dccf8f">)</font> <font color="#b64926">=</font> <font color="#dccf8f">(</font><font color="#586e75">"input"</font> <font color="#dccf8f">++</font> <font color="#dccf8f">show</font> <font color="#dccf8f">i</font> <font color="#dccf8f">++</font> <font color="#586e75">".txt"</font><font color="#dccf8f">,</font> <font color="#586e75">"output"</font> <font color="#dccf8f">++</font> <font color="#dccf8f">show</font> <font color="#dccf8f">i</font> <font color="#dccf8f">++</font> <font color="#586e75">".txt"</font><font color="#dccf8f">)</font>
<a name="line-4"></a>    <font color="#dccf8f">readFile</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">writeFile</font> <font color="#dccf8f">outf</font>
<a name="line-5"></a>    <font color="#b64926">where</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">content</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div><div>Without care we may exhaust our file descriptors.</div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">=</font> <font color="#dccf8f">withFile</font> <font color="#586e75">"input.txt"</font> <font color="#b58900">ReadMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">inf</font> <font color="#b64926">-&gt;</font>
<a name="line-3"></a>              <font color="#dccf8f">withFile</font> <font color="#586e75">"output.txt"</font> <font color="#b58900">WriteMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">outf</font> <font color="#b64926">-&gt;</font>
<a name="line-4"></a>                <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-5"></a>    <font color="#b64926">where</font>
<a name="line-6"></a>      <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-7"></a>        <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hGet</font> <font color="#dccf8f">inf</font> <font color="#586e75">4096</font>
<a name="line-8"></a>        <font color="#b64926">if</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">null</font> <font color="#dccf8f">str</font>
<a name="line-9"></a>          <font color="#b64926">then</font> <font color="#dccf8f">return</font> <font color="#b58900">()</font>
<a name="line-10"></a>          <font color="#b64926">else</font> <font color="#b64926">do</font>
<a name="line-11"></a>            <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hPut</font> <font color="#dccf8f">outf</font> <font color="#dccf8f">str</font>
<a name="line-12"></a>            <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">=</font> <font color="#dccf8f">withFile</font> <font color="#586e75">"input.txt"</font> <font color="#b58900">ReadMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">inf</font> <font color="#b64926">-&gt;</font>
<a name="line-3"></a>              <font color="#dccf8f">withFile</font> <font color="#586e75">"output.txt"</font> <font color="#b58900">WriteMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">outf</font> <font color="#b64926">-&gt;</font>
<a name="line-4"></a>                <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-5"></a>    <font color="#b64926">where</font>
<a name="line-6"></a>      <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-7"></a>        <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hGet</font> <font color="#dccf8f">inf</font> <font color="#586e75">4096</font>
<a name="line-8"></a>        <font color="#dccf8f">log</font> <font color="#dccf8f">str</font>
<a name="line-9"></a>        <font color="#b64926">if</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">null</font> <font color="#dccf8f">str</font>
<a name="line-10"></a>          <font color="#b64926">then</font> <font color="#dccf8f">return</font> <font color="#b58900">()</font>
<a name="line-11"></a>          <font color="#b64926">else</font> <font color="#b64926">do</font>
<a name="line-12"></a>            <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hPut</font> <font color="#dccf8f">outf</font> <font color="#dccf8f">str</font>
<a name="line-13"></a>            <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-14"></a>
<a name="line-15"></a>      <font color="#dccf8f">log</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-16"></a>      <font color="#dccf8f">log</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">=</font> <font color="#dccf8f">withFile</font> <font color="#586e75">"input.txt"</font> <font color="#b58900">ReadMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">inf</font> <font color="#b64926">-&gt;</font>
<a name="line-3"></a>              <font color="#dccf8f">withFile</font> <font color="#586e75">"output.txt"</font> <font color="#b58900">WriteMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">outf</font> <font color="#b64926">-&gt;</font>
<a name="line-4"></a>                <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-5"></a>    <font color="#b64926">where</font>
<a name="line-6"></a>      <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-7"></a>        <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hGet</font> <font color="#dccf8f">inf</font> <font color="#586e75">4096</font>
<a name="line-8"></a>        <font color="#dccf8f">when</font> <font color="#dccf8f">(</font><font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font> <font color="#dccf8f">$</font> <font color="#dccf8f">log</font> <font color="#dccf8f">str</font>
<a name="line-9"></a>        <font color="#b64926">if</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">null</font> <font color="#dccf8f">str</font>
<a name="line-10"></a>          <font color="#b64926">then</font> <font color="#dccf8f">return</font> <font color="#b58900">()</font>
<a name="line-11"></a>          <font color="#b64926">else</font> <font color="#b64926">do</font>
<a name="line-12"></a>            <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hPut</font> <font color="#dccf8f">outf</font> <font color="#dccf8f">str</font>
<a name="line-13"></a>            <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-14"></a>
<a name="line-15"></a>      <font color="#dccf8f">log</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-16"></a>      <font color="#dccf8f">log</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
<a name="line-17"></a>
<a name="line-18"></a>      <font color="#dccf8f">isInteresting</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font>
<a name="line-19"></a>      <font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">=</font> <font color="#dccf8f">withFile</font> <font color="#586e75">"input.txt"</font> <font color="#b58900">ReadMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">inf</font> <font color="#b64926">-&gt;</font>
<a name="line-3"></a>              <font color="#dccf8f">withFile</font> <font color="#586e75">"output.txt"</font> <font color="#b58900">WriteMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">outf</font> <font color="#b64926">-&gt;</font>
<a name="line-4"></a>                <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-5"></a>    <font color="#b64926">where</font>
<a name="line-6"></a>      <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-7"></a>        <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hGet</font> <font color="#dccf8f">inf</font> <font color="#586e75">4096</font>
<a name="line-8"></a>        <font color="#dccf8f">when</font> <font color="#dccf8f">(</font><font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font> <font color="#dccf8f">$</font> <font color="#dccf8f">log</font> <font color="#dccf8f">str</font>
<a name="line-9"></a>         <font color="#586e75"><i>--                  ^ How do we know was delimited correctly?</i></font>
<a name="line-10"></a>        <font color="#b64926">if</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">null</font> <font color="#dccf8f">str</font>
<a name="line-11"></a>          <font color="#b64926">then</font> <font color="#dccf8f">return</font> <font color="#b58900">()</font>
<a name="line-12"></a>          <font color="#b64926">else</font> <font color="#b64926">do</font>
<a name="line-13"></a>            <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hPut</font> <font color="#dccf8f">outf</font> <font color="#dccf8f">str</font>
<a name="line-14"></a>            <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-15"></a>
<a name="line-16"></a>      <font color="#dccf8f">log</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-17"></a>      <font color="#dccf8f">log</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
<a name="line-18"></a>
<a name="line-19"></a>      <font color="#dccf8f">isInteresting</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font>
<a name="line-20"></a>      <font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">=</font> <font color="#dccf8f">withFile</font> <font color="#586e75">"input.txt"</font> <font color="#b58900">ReadMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">inf</font> <font color="#b64926">-&gt;</font>
<a name="line-3"></a>              <font color="#dccf8f">withFile</font> <font color="#586e75">"output.txt"</font> <font color="#b58900">WriteMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">outf</font> <font color="#b64926">-&gt;</font>
<a name="line-4"></a>                <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-5"></a>    <font color="#b64926">where</font>
<a name="line-6"></a>      <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-7"></a>        <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hGet</font> <font color="#dccf8f">inf</font> <font color="#586e75">4096</font>
<a name="line-8"></a>        <font color="#dccf8f">when</font> <font color="#dccf8f">(</font><font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font> <font color="#dccf8f">$</font> <font color="#dccf8f">log</font> <font color="#dccf8f">str</font>
<a name="line-9"></a>         <font color="#586e75"><i>--                  ^ How do we know was delimited correctly?</i></font>
<a name="line-10"></a>        <font color="#b64926">if</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">null</font> <font color="#dccf8f">str</font>
<a name="line-11"></a>          <font color="#b64926">then</font> <font color="#dccf8f">return</font> <font color="#b58900">()</font>
<a name="line-12"></a>          <font color="#b64926">else</font> <font color="#b64926">do</font>
<a name="line-13"></a>            <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hPut</font> <font color="#dccf8f">outf</font> <font color="#dccf8f">str</font>
<a name="line-14"></a>            <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-15"></a>
<a name="line-16"></a>      <font color="#dccf8f">log</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-17"></a>      <font color="#dccf8f">log</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
<a name="line-18"></a>
<a name="line-19"></a>      <font color="#dccf8f">isInteresting</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font>
<a name="line-20"></a>      <font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div><div>Good on memory, good on resources management, but we completely lost composability.</div></section><section class="subsect"><div>What if we could break this into composable pieces?<pre><a name="line-1"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">=</font> <font color="#dccf8f">withFile</font> <font color="#586e75">"input.txt"</font> <font color="#b58900">ReadMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">inf</font> <font color="#b64926">-&gt;</font> <font color="#586e75"><i>-- step 1</i></font>
<a name="line-3"></a>              <font color="#dccf8f">withFile</font> <font color="#586e75">"output.txt"</font> <font color="#b58900">WriteMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">outf</font> <font color="#b64926">-&gt;</font> <font color="#586e75"><i>-- step 4</i></font>
<a name="line-4"></a>                <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-5"></a>    <font color="#b64926">where</font>
<a name="line-6"></a>      <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-7"></a>        <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hGet</font> <font color="#dccf8f">inf</font> <font color="#586e75">4096</font> <font color="#586e75"><i>-- step 2</i></font>
<a name="line-8"></a>        <font color="#dccf8f">when</font> <font color="#dccf8f">(</font><font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font> <font color="#dccf8f">$</font> <font color="#dccf8f">log</font> <font color="#dccf8f">str</font> <font color="#586e75"><i>-- step 3</i></font>
<a name="line-9"></a>        <font color="#b64926">if</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">null</font> <font color="#dccf8f">str</font>
<a name="line-10"></a>          <font color="#b64926">then</font> <font color="#dccf8f">return</font> <font color="#b58900">()</font>
<a name="line-11"></a>          <font color="#b64926">else</font> <font color="#b64926">do</font>
<a name="line-12"></a>            <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hPut</font> <font color="#dccf8f">outf</font> <font color="#dccf8f">str</font>
<a name="line-13"></a>            <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-14"></a>
<a name="line-15"></a>      <font color="#dccf8f">log</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-16"></a>      <font color="#dccf8f">log</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
<a name="line-17"></a>
<a name="line-18"></a>      <font color="#dccf8f">isInteresting</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font>
<a name="line-19"></a>      <font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">copyloop</font> <font color="#b64926">=</font> <font color="#dccf8f">withFile</font> <font color="#586e75">"input.txt"</font> <font color="#b58900">ReadMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">inf</font> <font color="#b64926">-&gt;</font> <font color="#586e75"><i>-- step 1</i></font>
<a name="line-3"></a>              <font color="#dccf8f">withFile</font> <font color="#586e75">"output.txt"</font> <font color="#b58900">WriteMode</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">outf</font> <font color="#b64926">-&gt;</font> <font color="#586e75"><i>-- step 4</i></font>
<a name="line-4"></a>                <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-5"></a>    <font color="#b64926">where</font>
<a name="line-6"></a>      <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-7"></a>        <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hGet</font> <font color="#dccf8f">inf</font> <font color="#586e75">4096</font> <font color="#586e75"><i>-- step 2</i></font>
<a name="line-8"></a>        <font color="#dccf8f">when</font> <font color="#dccf8f">(</font><font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font> <font color="#dccf8f">$</font> <font color="#dccf8f">log</font> <font color="#dccf8f">str</font> <font color="#586e75"><i>-- step 3</i></font>
<a name="line-9"></a>        <font color="#b64926">if</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">null</font> <font color="#dccf8f">str</font>
<a name="line-10"></a>          <font color="#b64926">then</font> <font color="#dccf8f">return</font> <font color="#b58900">()</font>
<a name="line-11"></a>          <font color="#b64926">else</font> <font color="#b64926">do</font>
<a name="line-12"></a>            <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">hPut</font> <font color="#dccf8f">outf</font> <font color="#dccf8f">str</font>
<a name="line-13"></a>            <font color="#dccf8f">loop</font> <font color="#dccf8f">inf</font> <font color="#dccf8f">outf</font>
<a name="line-14"></a>
<a name="line-15"></a>      <font color="#dccf8f">log</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-16"></a>      <font color="#dccf8f">log</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
<a name="line-17"></a>
<a name="line-18"></a>      <font color="#dccf8f">isInteresting</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font>
<a name="line-19"></a>      <font color="#dccf8f">isInteresting</font> <font color="#dccf8f">str</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre>step 1 -&gt; step 2 -&gt; step 3 -&gt; step 4</div></section></section><section class="sect"><section class="subsect"><div>History</div></section><section class="subsect"><div>History</div><div><li>2009 - Everyone has more or less given up on the prospect of lazy IO</li></div></section><section class="subsect"><div>History</div><div><li>2009 - Everyone has more or less given up on the prospect of lazy IO</li></div><div><li>2010 - John Millikin writes the enumerator library</li></div></section><section class="subsect"><div>History</div><div><li>2009 - Everyone has more or less given up on the prospect of lazy IO</li></div><div><li>2010 - John Millikin writes the enumerator library</li></div><div><li>It proves a basic idea, but the api is... a little janky</li></div></section><section class="subsect"><div>History</div><div><li>2009 - Everyone has more or less given up on the prospect of lazy IO</li></div><div><li>2010 - John Millikin writes the enumerator library</li></div><div><li>It proves a basic idea, but the api is... a little janky</li></div><div><li>2011 - Both Michael Snoyman and Gabriel Gonzales start conduits and pipes projects</li></div></section><section class="subsect"><div>History</div><div><li>2009 - Everyone has more or less given up on the prospect of lazy IO</li></div><div><li>2010 - John Millikin writes the enumerator library</li></div><div><li>It proves a basic idea, but the api is... a little janky</li></div><div><li>2011 - Both Michael Snoyman and Gabriel Gonzales start conduits and pipes projects</li></div><div><li>2012 - Conduits takes the early lead thanks to its more advanced functionality</li></div></section><section class="subsect"><div>History</div><div><li>2009 - Everyone has more or less given up on the prospect of lazy IO</li></div><div><li>2010 - John Millikin writes the enumerator library</li></div><div><li>It proves a basic idea, but the api is... a little janky</li></div><div><li>2011 - Both Michael Snoyman and Gabriel Gonzales start conduits and pipes projects</li></div><div><li>2012 - Conduits takes the early lead thanks to its more advanced functionality</li></div><div><li>Over time implementations get closer together and they begin to approach feature parity</li></div></section></section><section class="sect"><section class="subsect"><div>Pipes Introduction</div></section><section class="subsect"><div>The only type in the pipes library is the Proxy type<pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>The only type in the pipes library is the Proxy type<pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>Every other type in the pipes library is a type alias to Proxy</div></section></section><section class="sect"><section class="subsect"><div>Basic components of a Pipe</div></section><section class="subsect"><div>The Producer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>The Producer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre></div></section><section class="subsect"><div>The Producer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>produces an effectful series of a&#39;s</div></section><section class="subsect"><div>The Producer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>may produce none, may produce infinite</div></section><section class="subsect"><div>The Producer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>if it finishes, it returns r</div></section><section class="subsect"><div>The Producer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div><pre style="text-align: center">  <font color="#dccf8f">next</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Either</font> <font color="#dccf8f">r</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font><font color="#dccf8f">,</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font> 
</pre></div></section><section class="subsect"><div>The Producer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div><pre style="text-align: center">  <font color="#dccf8f">next</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Either</font> <font color="#dccf8f">r</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font><font color="#dccf8f">,</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font> 
</pre></div><div>sort of head and tail combined, but doesn&#39;t blow up on an empty list</div></section><section class="subsect"><div>The Producer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>producers are an instance of Monad, if m is</div></section><section class="subsect"><div>Producers may yield values down the pipe<pre style="text-align: center">  <font color="#dccf8f">yield</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">heytwice</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">heytwice</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#dccf8f">yield</font> <font color="#586e75">"hey."</font>
<a name="line-4"></a>    <font color="#dccf8f">yield</font> <font color="#586e75">"HEY!"</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">getLine</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">String</font>
<a name="line-2"></a>  
<a name="line-3"></a>  <font color="#dccf8f">stdin</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-4"></a>  <font color="#dccf8f">stdin</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-5"></a>    <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">lift</font> <font color="#dccf8f">getLine</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#b58900">IO</font> <font color="#b58900">String</font>
<a name="line-6"></a>    <font color="#dccf8f">yield</font> <font color="#dccf8f">str</font>           <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">getLine</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">String</font>
<a name="line-2"></a>  
<a name="line-3"></a>  <font color="#dccf8f">stdin</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-4"></a>  <font color="#dccf8f">stdin</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-5"></a>    <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">lift</font> <font color="#dccf8f">getLine</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#b58900">IO</font> <font color="#b58900">String</font>
<a name="line-6"></a>    <font color="#dccf8f">yield</font> <font color="#dccf8f">str</font>           <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
</pre></div><div>Note the return value r means it never ends.</div></section></section><section class="sect"><section class="subsect"><div>Basic components of a Pipe</div></section><section class="subsect"><div>The Consumer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>The Consumer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre></div></section><section class="subsect"><div>The Consumer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>consumes an effectful series of a&#39;s</div></section><section class="subsect"><div>The Consumer<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>again, may consume none, may consume everything forever</div></section><section class="subsect"><div>Consumers may await values from upstream<pre style="text-align: center">  <font color="#dccf8f">await</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Consumer'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font>
</pre></div></section><section class="subsect"><div>Consumers may await values from upstream<pre style="text-align: center">  <font color="#dccf8f">await</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Consumer'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font>
</pre></div><div><pre style="text-align: center">  <font color="#dccf8f">yield</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">countLettersOnce</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">countLettersOnce</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">await</font>
<a name="line-4"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">.</font> <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">.</font> <font color="#dccf8f">show</font> <font color="#dccf8f">.</font> <font color="#dccf8f">length</font> <font color="#dccf8f">$</font> <font color="#dccf8f">str</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">countLettersOnce</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">countLettersOnce</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">await</font>
<a name="line-4"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">.</font> <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">.</font> <font color="#dccf8f">show</font> <font color="#dccf8f">.</font> <font color="#dccf8f">length</font> <font color="#dccf8f">$</font> <font color="#dccf8f">str</font>
</pre></div><div><pre><a name="line-1"></a>  <font color="#dccf8f">countLettersTwice</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">countLettersTwice</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#dccf8f">countLettersOnce</font>
<a name="line-4"></a>    <font color="#dccf8f">countLettersOnce</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">countLettersOnce</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">countLettersOnce</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">await</font>
<a name="line-4"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">.</font> <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">.</font> <font color="#dccf8f">show</font> <font color="#dccf8f">.</font> <font color="#dccf8f">length</font> <font color="#dccf8f">$</font> <font color="#dccf8f">str</font>
</pre></div><div><pre><a name="line-1"></a>  <font color="#dccf8f">countLettersTwice</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">countLettersTwice</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#dccf8f">countLettersOnce</font>
<a name="line-4"></a>    <font color="#dccf8f">countLettersOnce</font>
</pre></div><div><pre><a name="line-1"></a>  <font color="#dccf8f">countLetters</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">countLetters</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">countLettersOnce</font>
</pre></div></section><section class="subsect"><div>A Producer can never await, a Consumer can never yield</div></section></section><section class="sect"><section class="subsect"><div>Tying Producers and Consumers Together creates an Effect</div></section><section class="subsect"><div>Tying Producers and Consumers Together creates an Effect</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">::</font> <font color="#b58900">Effect</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">=</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">countLetters</font>
</pre><pre><a name="line-1"></a>  <font color="#dccf8f">stdin</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">countLetters</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>Tying Producers and Consumers Together creates an Effect</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">::</font> <font color="#b58900">Effect</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">=</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">countLetters</font>
</pre><pre><a name="line-1"></a>  <font color="#dccf8f">stdin</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">countLetters</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
</pre></div><div><pre><a name="line-1"></a>  <font color="#586e75"><i>-- For now think of &gt;-&gt; as this type.</i></font>
<a name="line-2"></a>  <font color="#dccf8f">(</font><font color="#dccf8f">&gt;-&gt;</font><font color="#dccf8f">)</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Effect</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>Tying Producers and Consumers Together creates an Effect</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">::</font> <font color="#b58900">Effect</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">=</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">countLetters</font>
</pre><div>all yields in the producer are tied to the awaits in the consumer</div></div></section><section class="subsect"><div>Tying Producers and Consumers Together creates an Effect</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">::</font> <font color="#b58900">Effect</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">=</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">countLetters</font>
</pre><div>all yields in the producer are tied to the awaits in the consumer</div></div><div><pre><a name="line-1"></a>  <font color="#dccf8f">firstEffectTwice</font> <font color="#b64926">::</font> <font color="#b58900">Effect</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">firstEffectTwice</font> <font color="#b64926">=</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">countLettersTwice</font>
</pre>the pipe will run until any component finishes</div></section><section class="subsect"><div>Tying Producers and Consumers Together creates an Effect</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">::</font> <font color="#b58900">Effect</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">firstEffect</font> <font color="#b64926">=</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">countLetters</font>
</pre><div>all yields in the producer are tied to the awaits in the consumer</div></div><div>thus an Effect can never yield or await</div></section><section class="subsect"><div>To get back to your base type<pre style="text-align: center">  <font color="#dccf8f">runEffect</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Effect</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font>
</pre></div></section><section class="subsect"><div>To get back to your base type<pre style="text-align: center">  <font color="#dccf8f">runEffect</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Effect</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font>
</pre><pre><a name="line-1"></a>  <font color="#dccf8f">&gt;</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">countLetters</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">asdf</font>
<a name="line-3"></a>  <font color="#586e75">4</font>
<a name="line-4"></a>  <font color="#dccf8f">qwerty</font>
<a name="line-5"></a>  <font color="#586e75">5</font>
<a name="line-6"></a>  <font color="#dccf8f">more</font>
<a name="line-7"></a>  <font color="#586e75">4</font>
<a name="line-8"></a>  <font color="#dccf8f">...</font> <font color="#dccf8f">and</font> <font color="#dccf8f">so</font> <font color="#dccf8f">on</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>Basic components of a Pipe</div></section><section class="subsect"><div>The Pipe<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>The Pipe<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre></div></section><section class="subsect"><div>The Pipe<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre></div><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre></div></section><section class="subsect"><div>The Pipe<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>a pipe can both await AND yield</div></section><section class="subsect"><div>The Pipe<pre style="text-align: center">  <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>practically, a bridge between consumers and producers</div></section><section class="subsect"><div>Pipe examples</div></section><section class="subsect"><div>Pipe examples</div><div><pre><a name="line-1"></a>  <font color="#b64926">import</font> <font color="#b58900">Data</font><font color="#dccf8f">.</font><font color="#b58900">Char</font> <font color="#dccf8f">(</font><font color="#dccf8f">toUpper</font><font color="#dccf8f">)</font>
<a name="line-2"></a>
<a name="line-3"></a>  <font color="#dccf8f">upperPrint</font> <font color="#b64926">::</font> <font color="#b58900">Pipe</font> <font color="#b58900">String</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-4"></a>  <font color="#dccf8f">upperPrint</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-5"></a>    <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">await</font>
<a name="line-6"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">$</font> <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">(</font><font color="#dccf8f">map</font> <font color="#dccf8f">toUpper</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font>
<a name="line-7"></a>    <font color="#dccf8f">yield</font> <font color="#dccf8f">str</font>
</pre></div></section><section class="subsect"><div>Pipe examples</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">divPipe</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Pipe</font> <font color="#b58900">Int</font> <font color="#b58900">Double</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">divPipe</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#dccf8f">num1</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">await</font>
<a name="line-4"></a>    <font color="#dccf8f">num2</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">await</font>
<a name="line-5"></a>    <font color="#dccf8f">yield</font> <font color="#dccf8f">$</font> <font color="#dccf8f">fromIntegral</font> <font color="#dccf8f">num1</font> <font color="#dccf8f">/</font> <font color="#dccf8f">fromIntegral</font> <font color="#dccf8f">num2</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>Putting it all together</div></section><section class="subsect"><div><pre><a name="line-1"></a>   <font color="#586e75"><i>-- Monad m =&gt;</i></font>
<a name="line-2"></a>  <font color="#b64926">let</font> <font color="#dccf8f">pr</font> <font color="#b64926">=</font> <font color="#b64926">_</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font>   <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-3"></a>      <font color="#dccf8f">p1</font> <font color="#b64926">=</font> <font color="#b64926">_</font> <font color="#b64926">::</font> <font color="#b58900">Pipe</font>     <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-4"></a>      <font color="#dccf8f">p2</font> <font color="#b64926">=</font> <font color="#b64926">_</font> <font color="#b64926">::</font> <font color="#b58900">Pipe</font>     <font color="#dccf8f">b</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#b58900">Int</font> <font color="#586e75"><i>-- exhaustible</i></font>
<a name="line-5"></a>      <font color="#dccf8f">cs</font> <font color="#b64926">=</font> <font color="#b64926">_</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">c</font>   <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-6"></a>
<a name="line-7"></a>  <font color="#b64926">let</font>
<a name="line-8"></a>    <font color="#dccf8f">foo</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-9"></a>    <font color="#dccf8f">foo</font> <font color="#b64926">=</font> <font color="#dccf8f">pr</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">p1</font>
<a name="line-10"></a>    
<a name="line-11"></a>    <font color="#dccf8f">foo2</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-12"></a>    <font color="#dccf8f">foo2</font> <font color="#b64926">=</font> <font color="#dccf8f">pr</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">p1</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">p2</font>
<a name="line-13"></a>
<a name="line-14"></a>    <font color="#dccf8f">foo3</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#b58900">Int</font>
<a name="line-15"></a>    <font color="#dccf8f">foo3</font> <font color="#b64926">=</font> <font color="#dccf8f">p2</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">cs</font>
<a name="line-16"></a>
<a name="line-17"></a>    <font color="#dccf8f">foo4</font> <font color="#b64926">::</font> <font color="#b58900">Effect</font> <font color="#dccf8f">m</font> <font color="#b58900">Int</font> <font color="#586e75"><i>-- ends when p2 ends</i></font>
<a name="line-18"></a>    <font color="#dccf8f">foo4</font> <font color="#b64926">=</font> <font color="#dccf8f">pr</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">p1</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">p2</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">cs</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#586e75"><i>-- In effect &gt;-&gt; has these types. (Monad m =&gt;)</i></font>
<a name="line-2"></a><a name="%3e-%3e"></a><font color="#dccf8f">(</font><font color="#dccf8f">&gt;-&gt;</font><font color="#dccf8f">)</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font>     <font color="#dccf8f">b</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer</font>   <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-3"></a><font color="#dccf8f">(</font><font color="#dccf8f">&gt;-&gt;</font><font color="#dccf8f">)</font> <font color="#b64926">::</font> <font color="#b58900">Pipe</font>   <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">b</font>   <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font>   <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-4"></a><font color="#dccf8f">(</font><font color="#dccf8f">&gt;-&gt;</font><font color="#dccf8f">)</font> <font color="#b64926">::</font> <font color="#b58900">Pipe</font>   <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font>     <font color="#dccf8f">b</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font>     <font color="#dccf8f">a</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-5"></a><font color="#dccf8f">(</font><font color="#dccf8f">&gt;-&gt;</font><font color="#dccf8f">)</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">b</font>   <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Effect</font>       <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>Side Note: Producers and Consumers are heavily type restricted.</div></section><section class="subsect"><div>Side Note: Producers and Consumers are heavily type restricted.</div><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre></div></section><section class="subsect"><div>Side Note: Producers and Consumers are heavily type restricted.</div><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer'</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b64926">forall</font> <font color="#dccf8f">x'</font> <font color="#dccf8f">x</font><font color="#dccf8f">.</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">x'</font> <font color="#dccf8f">x</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer'</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b64926">forall</font> <font color="#dccf8f">y'</font> <font color="#dccf8f">y</font><font color="#dccf8f">.</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#dccf8f">y'</font> <font color="#dccf8f">y</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>Side Note: Producers and Consumers are heavily type restricted.</div><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer'</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b64926">forall</font> <font color="#dccf8f">x'</font> <font color="#dccf8f">x</font><font color="#dccf8f">.</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">x'</font> <font color="#dccf8f">x</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer'</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b64926">forall</font> <font color="#dccf8f">y'</font> <font color="#dccf8f">y</font><font color="#dccf8f">.</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#dccf8f">y'</font> <font color="#dccf8f">y</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div><pre style="text-align: center">  <font color="#dccf8f">yield</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
</pre><pre style="text-align: center">  <font color="#dccf8f">await</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Consumer'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre></div></section></section><section class="sect"><section class="subsect"><div>With this much knowledge you can be very productive with pipes.</div></section><section class="subsect"><div>Pipes comes with a lot of utilities</div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#b64926">import</font> <font color="#b58900">Pipes</font><font color="#dccf8f">.</font><font color="#b58900">Prelude</font> <font color="#b64926">as</font> <font color="#b58900">P</font>
<a name="line-2"></a>
<a name="line-3"></a>  <font color="#586e75"><i>-- print each element as it is consumed.</i></font>
<a name="line-4"></a>  <font color="#dccf8f">print</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">Show</font> <font color="#dccf8f">a</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Consumer'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-5"></a>
<a name="line-6"></a>  <font color="#586e75"><i>-- Any foldable into a producer.</i></font>
<a name="line-7"></a>  <font color="#dccf8f">each</font> <font color="#dccf8f">(</font><font color="#b58900">Monad</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">Foldable</font> <font color="#dccf8f">f</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">f</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font> 
<a name="line-8"></a>  <font color="#dccf8f">&gt;</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">each</font> <font color="#b64926">[</font><font color="#586e75">1</font><font color="#dccf8f">,</font><font color="#586e75">2</font><font color="#dccf8f">,</font><font color="#586e75">3</font><font color="#b64926">]</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
<a name="line-9"></a>  <font color="#586e75">1</font>
<a name="line-10"></a>  <font color="#586e75">2</font>
<a name="line-11"></a>  <font color="#586e75">3</font>
<a name="line-12"></a>
<a name="line-13"></a>  <font color="#586e75"><i>-- Run possibly effectful functions on each input.</i></font>
<a name="line-14"></a>  <font color="#dccf8f">map</font>   <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">b</font><font color="#dccf8f">)</font>    <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-15"></a>  <font color="#dccf8f">mapM</font>  <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">b</font><font color="#dccf8f">)</font>  <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-16"></a>  <font color="#dccf8f">mapM_</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Consumer'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-17"></a>
<a name="line-18"></a>  <font color="#dccf8f">&gt;</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">each</font> <font color="#b64926">[</font><font color="#586e75">1</font><font color="#dccf8f">,</font><font color="#586e75">2</font><font color="#dccf8f">,</font><font color="#586e75">3</font><font color="#b64926">]</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">map</font> <font color="#dccf8f">(</font><font color="#dccf8f">+</font><font color="#586e75">1</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
<a name="line-19"></a>  <font color="#586e75">2</font>
<a name="line-20"></a>  <font color="#586e75">3</font>
<a name="line-21"></a>  <font color="#586e75">4</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#586e75"><i>-- produces strings from stdin until end of input</i></font>
<a name="line-2"></a>  <font color="#dccf8f">stdinLn</font> <font color="#b64926">::</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer'</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font> 
<a name="line-3"></a>
<a name="line-4"></a>  <font color="#586e75"><i>-- pass elements along until condition is met, then end</i></font>
<a name="line-5"></a>  <font color="#dccf8f">take</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Int</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
<a name="line-6"></a>  <font color="#dccf8f">takeWhile</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font> 
<a name="line-7"></a>
<a name="line-8"></a>  <font color="#dccf8f">&gt;</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">stdinLn</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">takeWhile</font> <font color="#dccf8f">(</font><font color="#dccf8f">/=</font> <font color="#586e75">"quit"</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;-&gt;</font>
<a name="line-9"></a>      <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">mapM_</font> <font color="#dccf8f">(</font><font color="#dccf8f">print</font> <font color="#dccf8f">.</font> <font color="#dccf8f">length</font><font color="#dccf8f">)</font>
<a name="line-10"></a>  <font color="#dccf8f">foo</font>
<a name="line-11"></a>  <font color="#586e75">3</font>
<a name="line-12"></a>  <font color="#dccf8f">bar</font>
<a name="line-13"></a>  <font color="#586e75">4</font>
<a name="line-14"></a>  <font color="#dccf8f">quit</font>
<a name="line-15"></a>  <font color="#dccf8f">&gt;</font>
<a name="line-16"></a>  <font color="#586e75"><i>-- skip elements until a condition is met</i></font>
<a name="line-17"></a>  <font color="#dccf8f">drop</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Int</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-18"></a>  <font color="#dccf8f">dropWhile</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-19"></a>
<a name="line-20"></a>  <font color="#586e75"><i>-- elementwise tests on producers</i></font>
<a name="line-21"></a>  <font color="#dccf8f">null</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#b58900">Bool</font>
<a name="line-22"></a>  <font color="#dccf8f">all</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#b58900">Bool</font>
<a name="line-23"></a>  <font color="#dccf8f">any</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#b58900">Bool</font>
<a name="line-24"></a>  <font color="#dccf8f">find</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#dccf8f">a</font><font color="#dccf8f">)</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">findIndex</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Bool</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
<a name="line-2"></a>      <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#b58900">Int</font><font color="#dccf8f">)</font>
<a name="line-3"></a>
<a name="line-4"></a>  <font color="#dccf8f">sum</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">Monad</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">Num</font> <font color="#dccf8f">a</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font> 
<a name="line-5"></a>
<a name="line-6"></a>  <font color="#dccf8f">toList</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#b58900">Identity</font> <font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#b64926">[</font><font color="#dccf8f">a</font><font color="#b64926">]</font>
<a name="line-7"></a>  <font color="#dccf8f">toListM</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#b64926">[</font><font color="#dccf8f">a</font><font color="#b64926">]</font>
<a name="line-8"></a>
<a name="line-9"></a>  <font color="#dccf8f">zip</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font>
<a name="line-10"></a>          <font color="#b58900">Producer'</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font><font color="#dccf8f">,</font> <font color="#dccf8f">b</font><font color="#dccf8f">)</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-11"></a>
<a name="line-12"></a>  <font color="#586e75"><i>-- among many others.</i></font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>Since Producer, Pipe and Consumer are actually type aliases<pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>Since Producer, Pipe and Consumer are actually type aliases<pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>You might be wondering what these extra variables for?</div></section><section class="subsect"><div>Since Producer, Pipe and Consumer are actually type aliases<pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>It turns out pipes are bidirectional if you need them to be</div></section><section class="subsect"><div>Since Producer, Pipe and Consumer are actually type aliases<pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>And in fact a unidirectional pipe is actually bidirectional under the hood</div></section><section class="subsect"><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div><pre><a name="line-1"></a>     <font color="#b58900">Upstream</font> <font color="#b64926">|</font> <font color="#b58900">Downstream</font>
<a name="line-2"></a>         <font color="#dccf8f">+---------+</font>
<a name="line-3"></a>         <font color="#b64926">|</font>         <font color="#b64926">|</font>
<a name="line-4"></a>     <font color="#dccf8f">a'</font> <font color="#dccf8f">&lt;==</font>       <font color="#dccf8f">&lt;==</font> <font color="#dccf8f">b'</font>
<a name="line-5"></a>         <font color="#b64926">|</font>         <font color="#b64926">|</font>
<a name="line-6"></a>     <font color="#dccf8f">a</font>  <font color="#dccf8f">==&gt;</font>       <font color="#dccf8f">==&gt;</font> <font color="#dccf8f">b</font>
<a name="line-7"></a>         <font color="#b64926">|</font>    <font color="#b64926">|</font>    <font color="#b64926">|</font>
<a name="line-8"></a>         <font color="#dccf8f">+----|----+</font>
<a name="line-9"></a>              <font color="#dccf8f">v</font>
<a name="line-10"></a>              <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div><pre><a name="line-1"></a>  <font color="#586e75"><i>-- The real type of &gt;-&gt;</i></font>
<a name="line-2"></a>  <font color="#dccf8f">(</font><font color="#dccf8f">&gt;-&gt;</font><font color="#dccf8f">)</font> <font color="#b64926">infixl</font> <font color="#586e75">7</font>
<a name="line-3"></a>    <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font>
<a name="line-4"></a>    <font color="#b64926">=&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-5"></a>    <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> <font color="#dccf8f">c'</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-6"></a>    <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">c'</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>Normally if you import Pipes, you get yield and await.</div></section><section class="subsect"><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>But if you import Pipes.Core, you get different primitives.<pre><a name="line-1"></a>  <font color="#dccf8f">respond</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">x'</font> <font color="#dccf8f">x</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a'</font>
<a name="line-2"></a>  <font color="#dccf8f">request</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a'</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">y'</font> <font color="#dccf8f">y</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font> 
<a name="line-3"></a>  <font color="#dccf8f">push</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-4"></a>  <font color="#dccf8f">pull</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a'</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
</pre></div></section><section class="subsect"><div><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Producer</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> 
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Consumer</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">type</font> <font color="#b58900">Effect</font> <font color="#b64926">=</font> <font color="#b58900">Proxy</font> <font color="#b58900">X</font> <font color="#b58900">()</font> <font color="#b58900">()</font> <font color="#b58900">X</font>
</pre><pre style="text-align: center">  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div><div>But if you import Pipes.Core, you get different primitives.<pre><a name="line-1"></a>  <font color="#dccf8f">respond</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">x'</font> <font color="#dccf8f">x</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a'</font>
<a name="line-2"></a>  <font color="#dccf8f">request</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a'</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">y'</font> <font color="#dccf8f">y</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font> 
<a name="line-3"></a>  <font color="#dccf8f">push</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-4"></a>  <font color="#dccf8f">pull</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a'</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
</pre></div><div><pre><a name="line-1"></a>  <font color="#dccf8f">yield</font> <font color="#b64926">=</font> <font color="#dccf8f">respond</font> <font color="#b64926">::</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">x'</font> <font color="#dccf8f">x</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">await</font> <font color="#b64926">=</font> <font color="#dccf8f">request</font> <font color="#b58900">()</font> <font color="#b64926">::</font> <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">a</font> <font color="#dccf8f">y'</font> <font color="#dccf8f">y</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>Pipes can be stateful</div></section><section class="subsect"><div>Pipes can be stateful</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">counterExample</font> <font color="#b64926">::</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">counterExample</font> <font color="#b64926">=</font> <font color="#dccf8f">flip</font> <font color="#dccf8f">evalStateT</font> <font color="#586e75">0</font> <font color="#dccf8f">loop</font>
<a name="line-3"></a>    <font color="#b64926">where</font>
<a name="line-4"></a>      <font color="#dccf8f">loop</font> <font color="#b64926">::</font> <font color="#b58900">StateT</font> <font color="#b58900">Int</font> <font color="#dccf8f">(</font><font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font><font color="#dccf8f">)</font>
<a name="line-5"></a>      <font color="#dccf8f">loop</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-6"></a>        <font color="#dccf8f">a</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">lift</font> <font color="#dccf8f">await</font>
<a name="line-7"></a>        <font color="#dccf8f">modify</font> <font color="#dccf8f">(</font><font color="#dccf8f">+</font><font color="#586e75">1</font><font color="#dccf8f">)</font>
<a name="line-8"></a>        <font color="#dccf8f">count</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">get</font>
<a name="line-9"></a>        <font color="#dccf8f">liftIO</font> <font color="#dccf8f">.</font> <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">$</font> <font color="#586e75">"so far: "</font> <font color="#dccf8f">++</font> <font color="#dccf8f">show</font> <font color="#dccf8f">count</font>
<a name="line-10"></a>        <font color="#dccf8f">lift</font> <font color="#dccf8f">$</font> <font color="#dccf8f">yield</font> <font color="#dccf8f">a</font>
<a name="line-11"></a>
<a name="line-12"></a>  <font color="#dccf8f">testCounter</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-13"></a>  <font color="#dccf8f">testCounter</font> <font color="#b64926">=</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">each</font> <font color="#586e75">"abc"</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">counterExample</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
</pre></div></section><section class="subsect"><div>Pipes can be stateful</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">counterExample</font> <font color="#b64926">::</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">counterExample</font> <font color="#b64926">=</font> <font color="#dccf8f">flip</font> <font color="#dccf8f">evalStateT</font> <font color="#586e75">0</font> <font color="#dccf8f">loop</font>
<a name="line-3"></a>    <font color="#b64926">where</font>
<a name="line-4"></a>      <font color="#dccf8f">loop</font> <font color="#b64926">::</font> <font color="#b58900">StateT</font> <font color="#b58900">Int</font> <font color="#dccf8f">(</font><font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font><font color="#dccf8f">)</font>
<a name="line-5"></a>      <font color="#dccf8f">loop</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-6"></a>        <font color="#dccf8f">a</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">lift</font> <font color="#dccf8f">await</font>
<a name="line-7"></a>        <font color="#dccf8f">modify</font> <font color="#dccf8f">(</font><font color="#dccf8f">+</font><font color="#586e75">1</font><font color="#dccf8f">)</font>
<a name="line-8"></a>        <font color="#dccf8f">count</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">get</font>
<a name="line-9"></a>        <font color="#dccf8f">liftIO</font> <font color="#dccf8f">.</font> <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">$</font> <font color="#586e75">"so far: "</font> <font color="#dccf8f">++</font> <font color="#dccf8f">show</font> <font color="#dccf8f">count</font>
<a name="line-10"></a>        <font color="#dccf8f">lift</font> <font color="#dccf8f">$</font> <font color="#dccf8f">yield</font> <font color="#dccf8f">a</font>
<a name="line-11"></a>
<a name="line-12"></a>  <font color="#dccf8f">testCounter</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-13"></a>  <font color="#dccf8f">testCounter</font> <font color="#b64926">=</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">each</font> <font color="#586e75">"abc"</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">counterExample</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
</pre></div><div><pre><a name="line-1"></a><font color="#dccf8f">&gt;</font><font color="#dccf8f">testCounter</font>
<a name="line-2"></a><a name="so"></a><font color="#dccf8f">so</font> <font color="#dccf8f">far</font><font color="#dccf8f">:</font> <font color="#586e75">1</font>
<a name="line-3"></a><font color="#586e75">'a'</font>
<a name="line-4"></a><font color="#dccf8f">so</font> <font color="#dccf8f">far</font><font color="#dccf8f">:</font> <font color="#586e75">2</font>
<a name="line-5"></a><font color="#586e75">'b'</font>
<a name="line-6"></a><font color="#dccf8f">so</font> <font color="#dccf8f">far</font><font color="#dccf8f">:</font> <font color="#586e75">3</font>
<a name="line-7"></a><font color="#586e75">'c'</font>
</pre></div></section><section class="subsect"><div>Pipes can be stateful</div><div><pre><a name="line-1"></a>  <font color="#b64926">import</font> <font color="#b58900">Pipes</font><font color="#dccf8f">.</font><font color="#b58900">Lift</font> <font color="#b64926">as</font> <font color="#b58900">P</font>
<a name="line-2"></a>
<a name="line-3"></a>  <font color="#586e75"><i>-- instance MonadState s m =&gt; MonadState s (Proxy a' a b' b m)</i></font>
<a name="line-4"></a>
<a name="line-5"></a>  <font color="#dccf8f">counterExample</font> <font color="#b64926">::</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-6"></a>  <font color="#dccf8f">counterExample</font> <font color="#b64926">=</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">evalStateP</font> <font color="#586e75">0</font> <font color="#dccf8f">loop</font>
<a name="line-7"></a>    <font color="#b64926">where</font>
<a name="line-8"></a>      <font color="#dccf8f">loop</font> <font color="#b64926">::</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">a</font> <font color="#dccf8f">a</font> <font color="#dccf8f">(</font><font color="#b58900">StateT</font> <font color="#b58900">Int</font> <font color="#b58900">IO</font><font color="#dccf8f">)</font> <font color="#dccf8f">r</font>
<a name="line-9"></a>      <font color="#dccf8f">loop</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-10"></a>        <font color="#dccf8f">a</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">await</font>
<a name="line-11"></a>        <font color="#dccf8f">modify</font> <font color="#dccf8f">(</font><font color="#dccf8f">+</font><font color="#586e75">1</font><font color="#dccf8f">)</font>
<a name="line-12"></a>        <font color="#dccf8f">count</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">get</font>
<a name="line-13"></a>        <font color="#dccf8f">liftIO</font> <font color="#dccf8f">.</font> <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">$</font> <font color="#586e75">"so far: "</font> <font color="#dccf8f">++</font> <font color="#dccf8f">show</font> <font color="#dccf8f">count</font>
<a name="line-14"></a>        <font color="#dccf8f">yield</font> <font color="#dccf8f">a</font>
<a name="line-15"></a>
<a name="line-16"></a>  <font color="#dccf8f">testCounter</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-17"></a>  <font color="#dccf8f">testCounter</font> <font color="#b64926">=</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">each</font> <font color="#586e75">"abc"</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">counterExample</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>There are many Interesting libraries in the pipes ecosystem</div></section><section class="subsect"><div>pipes-zlib</div></section><section class="subsect"><div>pipes-zlib</div><div><pre style="text-align: center">  <font color="#586e75"><i>-- for both gzip and zlib</i></font>
  <font color="#dccf8f">compress</font> <font color="#b64926">::</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font>
           <font color="#b64926">=&gt;</font> <font color="#b58900">CompressionLevel</font>
           <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#b58900">ByteString</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
           <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#b58900">ByteString</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>

  <font color="#dccf8f">decompress</font> <font color="#b64926">::</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font>
           <font color="#b64926">=&gt;</font> <font color="#b58900">Producer'</font> <font color="#b58900">ByteString</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
           <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#b58900">ByteString</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>pipes-network (with network-simple)</div></section><section class="subsect"><div>pipes-network (with network-simple)</div><div><pre style="text-align: center">  <font color="#586e75"><i>-- a consumer of data from a socket, inexhaustible</i></font>
  <font color="#dccf8f">toSocket</font> <font color="#b64926">::</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Socket</font> <font color="#b64926">-&gt;</font>
               <font color="#b58900">Consumer'</font> <font color="#b58900">ByteString</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>

  <font color="#586e75"><i>-- a producer that reads at most n bytes, exhausted if connection closes.</i></font>
  <font color="#dccf8f">fromSocket</font> <font color="#b64926">::</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Socket</font> <font color="#dccf8f">&gt;</font> <font color="#b58900">Int</font> <font color="#b64926">-&gt;</font>
                 <font color="#b58900">Producer'</font> <font color="#b58900">ByteString</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
</pre></div></section><section class="subsect"><div>pipes-network (with network-simple)</div><div><pre style="text-align: center">  <font color="#586e75"><i>-- a consumer of data from a socket, inexhaustible</i></font>
  <font color="#dccf8f">toSocket</font> <font color="#b64926">::</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Socket</font> <font color="#b64926">-&gt;</font>
               <font color="#b58900">Consumer'</font> <font color="#b58900">ByteString</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>

  <font color="#586e75"><i>-- a producer that reads at most n bytes, exhausted if connection closes.</i></font>
  <font color="#dccf8f">fromSocket</font> <font color="#b64926">::</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Socket</font> <font color="#dccf8f">&gt;</font> <font color="#b58900">Int</font> <font color="#b64926">-&gt;</font>
                 <font color="#b58900">Producer'</font> <font color="#b58900">ByteString</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
</pre></div><div><pre><a name="line-1"></a>  <font color="#b64926">import</font> <font color="#b64926">qualified</font> <font color="#b58900">Pipes</font><font color="#dccf8f">.</font><font color="#b58900">Network</font><font color="#dccf8f">.</font><font color="#b58900">TCP</font> <font color="#b64926">as</font> <font color="#b58900">P</font>
<a name="line-2"></a>  <font color="#b64926">import</font> <font color="#b58900">Pipes</font><font color="#dccf8f">.</font><font color="#b58900">Prelude</font> <font color="#b64926">as</font> <font color="#b58900">P</font> <font color="#dccf8f">(</font><font color="#dccf8f">print</font><font color="#dccf8f">)</font>
<a name="line-3"></a>  <font color="#b64926">import</font> <font color="#b58900">Network</font><font color="#dccf8f">.</font><font color="#b58900">Simple</font><font color="#dccf8f">.</font><font color="#b58900">TCP</font> <font color="#dccf8f">(</font><font color="#dccf8f">serve</font><font color="#dccf8f">,</font> <font color="#b58900">HostPreference</font><font color="#dccf8f">(</font><font color="#b64926">..</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font>
<a name="line-4"></a>  <font color="#b64926">import</font> <font color="#b64926">qualified</font> <font color="#b58900">Data</font><font color="#dccf8f">.</font><font color="#b58900">ByteString</font><font color="#dccf8f">.</font><font color="#b58900">Char8</font> <font color="#b64926">as</font> <font color="#b58900">B</font> <font color="#dccf8f">(</font><font color="#dccf8f">getLine</font><font color="#dccf8f">,</font> <font color="#dccf8f">putStrLn</font><font color="#dccf8f">)</font>
<a name="line-5"></a>
<a name="line-6"></a>  <font color="#dccf8f">netExample</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-7"></a>  <font color="#dccf8f">netExample</font> <font color="#b64926">=</font> <font color="#dccf8f">serve</font> <font color="#dccf8f">(</font><font color="#b58900">Host</font> <font color="#586e75">"127.0.0.1"</font><font color="#dccf8f">)</font> <font color="#586e75">"8000"</font> <font color="#dccf8f">$</font> <font color="#b64926">\</font><font color="#dccf8f">(</font><font color="#dccf8f">sock</font><font color="#dccf8f">,</font> <font color="#b64926">_</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b64926">do</font>
<a name="line-8"></a>      <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">fromSocket</font> <font color="#dccf8f">sock</font> <font color="#586e75">4096</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">toSocket</font> <font color="#dccf8f">sock</font>
<a name="line-9"></a>
<a name="line-10"></a>  <font color="#dccf8f">stdinExample</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-11"></a>  <font color="#dccf8f">stdinExample</font> <font color="#b64926">=</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> 
<a name="line-12"></a>    <font color="#dccf8f">forever</font> <font color="#dccf8f">(</font><font color="#dccf8f">lift</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">getLine</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">yield</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">doSomething</font> <font color="#dccf8f">&gt;-&gt;</font>
<a name="line-13"></a>      <font color="#dccf8f">forever</font> <font color="#dccf8f">(</font><font color="#dccf8f">await</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">lift</font> <font color="#dccf8f">.</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#dccf8f">putStrLn</font><font color="#dccf8f">)</font>
<a name="line-14"></a>
<a name="line-15"></a>  <font color="#586e75"><i>-- This function doesn't care how it is used.</i></font>
<a name="line-16"></a>  <font color="#dccf8f">doSomething</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Pipe</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#b58900">ByteString</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#b58900">ByteString</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-17"></a>  <font color="#dccf8f">doSomething</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>Pipes can handle resource acquisition and release (via pipes-safe)</div></section><section class="subsect"><div>Pipes can handle resource acquisition and release (via pipes-safe)</div><div>This is very similar to the resourcet library, they are almost interchangeable</div></section><section class="subsect"><div>Pipes can handle resource acquisition and release (via pipes-safe)</div><div><pre><a name="line-1"></a>  <font color="#b64926">import</font> <font color="#b64926">qualified</font> <font color="#b58900">Pipes</font><font color="#dccf8f">.</font><font color="#b58900">Safe</font> <font color="#b64926">as</font> <font color="#b58900">P</font>
<a name="line-2"></a>  <font color="#b64926">import</font> <font color="#b58900">System</font><font color="#dccf8f">.</font><font color="#b58900">IO</font> <font color="#b64926">as</font> <font color="#b58900">IO</font>
<a name="line-3"></a>
<a name="line-4"></a>  <font color="#586e75"><i>-- An actual usable version of this fuction in Pipes.Safe.Prelude</i></font>
<a name="line-5"></a>  <font color="#586e75"><i>-- is called readFile, along with counterparts writeFile, withFile</i></font>
<a name="line-6"></a>  <font color="#dccf8f">readFileExample</font> <font color="#b64926">::</font> <font color="#b58900">FilePath</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#b58900">String</font> <font color="#dccf8f">(</font><font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#b58900">SafeT</font> <font color="#b58900">IO</font><font color="#dccf8f">)</font> <font color="#b58900">()</font>
<a name="line-7"></a>  <font color="#dccf8f">readFileExample</font> <font color="#dccf8f">file</font> <font color="#b64926">=</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">bracket</font>
<a name="line-8"></a>      <font color="#dccf8f">(</font><font color="#b64926">do</font> <font color="#dccf8f">h</font> <font color="#b64926">&lt;-</font> <font color="#b58900">IO</font><font color="#dccf8f">.</font><font color="#dccf8f">openFile</font> <font color="#dccf8f">file</font> <font color="#b58900">IO</font><font color="#dccf8f">.</font><font color="#b58900">ReadMode</font>
<a name="line-9"></a>          <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">$</font> <font color="#586e75">"{"</font> <font color="#dccf8f">++</font> <font color="#dccf8f">file</font> <font color="#dccf8f">++</font> <font color="#586e75">" open}"</font>
<a name="line-10"></a>          <font color="#dccf8f">return</font> <font color="#dccf8f">h</font> <font color="#dccf8f">)</font>
<a name="line-11"></a>      <font color="#dccf8f">(</font><font color="#b64926">\</font><font color="#dccf8f">h</font> <font color="#b64926">-&gt;</font> <font color="#b64926">do</font>
<a name="line-12"></a>          <font color="#b58900">IO</font><font color="#dccf8f">.</font><font color="#dccf8f">hClose</font> <font color="#dccf8f">h</font>
<a name="line-13"></a>          <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">$</font> <font color="#586e75">"{"</font> <font color="#dccf8f">++</font> <font color="#dccf8f">file</font> <font color="#dccf8f">++</font> <font color="#586e75">" closed}"</font> <font color="#dccf8f">)</font>
<a name="line-14"></a>      <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">fromHandle</font> <font color="#586e75"><i>-- :: Handle -&gt; Producer' String IO ()</i></font>
<a name="line-15"></a>
<a name="line-16"></a>  <font color="#586e75"><i>-- mnemonic SafeT stands for Safe Transformer.</i></font>
<a name="line-17"></a>  <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">runSafeT</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">MonadMask</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font> <font color="#b58900">SafeT</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
</pre></div></section><section class="subsect"><div>Pipes can handle resource acquisition and release (via pipes-safe)</div><div><pre><a name="line-1"></a>  <font color="#b64926">import</font> <font color="#b64926">qualified</font> <font color="#b58900">Pipes</font><font color="#dccf8f">.</font><font color="#b58900">Safe</font> <font color="#b64926">as</font> <font color="#b58900">P</font>
<a name="line-2"></a>  <font color="#b64926">import</font> <font color="#b58900">System</font><font color="#dccf8f">.</font><font color="#b58900">IO</font> <font color="#b64926">as</font> <font color="#b58900">IO</font>
<a name="line-3"></a>
<a name="line-4"></a>  <font color="#586e75"><i>-- An actual usable version of this fuction in Pipes.Safe.Prelude</i></font>
<a name="line-5"></a>  <font color="#586e75"><i>-- is called readFile, along with counterparts writeFile, withFile</i></font>
<a name="line-6"></a>  <font color="#dccf8f">readFileExample</font> <font color="#b64926">::</font> <font color="#b58900">FilePath</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#b58900">String</font> <font color="#dccf8f">(</font><font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#b58900">SafeT</font> <font color="#b58900">IO</font><font color="#dccf8f">)</font> <font color="#b58900">()</font>
<a name="line-7"></a>  <font color="#dccf8f">readFileExample</font> <font color="#dccf8f">file</font> <font color="#b64926">=</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">bracket</font>
<a name="line-8"></a>      <font color="#dccf8f">(</font><font color="#b64926">do</font> <font color="#dccf8f">h</font> <font color="#b64926">&lt;-</font> <font color="#b58900">IO</font><font color="#dccf8f">.</font><font color="#dccf8f">openFile</font> <font color="#dccf8f">file</font> <font color="#b58900">IO</font><font color="#dccf8f">.</font><font color="#b58900">ReadMode</font>
<a name="line-9"></a>          <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">$</font> <font color="#586e75">"{"</font> <font color="#dccf8f">++</font> <font color="#dccf8f">file</font> <font color="#dccf8f">++</font> <font color="#586e75">" open}"</font>
<a name="line-10"></a>          <font color="#dccf8f">return</font> <font color="#dccf8f">h</font> <font color="#dccf8f">)</font>
<a name="line-11"></a>      <font color="#dccf8f">(</font><font color="#b64926">\</font><font color="#dccf8f">h</font> <font color="#b64926">-&gt;</font> <font color="#b64926">do</font>
<a name="line-12"></a>          <font color="#b58900">IO</font><font color="#dccf8f">.</font><font color="#dccf8f">hClose</font> <font color="#dccf8f">h</font>
<a name="line-13"></a>          <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">$</font> <font color="#586e75">"{"</font> <font color="#dccf8f">++</font> <font color="#dccf8f">file</font> <font color="#dccf8f">++</font> <font color="#586e75">" closed}"</font> <font color="#dccf8f">)</font>
<a name="line-14"></a>      <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">fromHandle</font> <font color="#586e75"><i>-- :: Handle -&gt; Producer' String IO ()</i></font>
<a name="line-15"></a>
<a name="line-16"></a>  <font color="#586e75"><i>-- mnemonic SafeT stands for Safe Transformer.</i></font>
<a name="line-17"></a>  <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">runSafeT</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">MonadMask</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font> <font color="#b58900">SafeT</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
</pre></div><div><pre><a name="line-1"></a>  <font color="#dccf8f">&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">runSafeT</font> <font color="#dccf8f">$</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">readFileExample</font> <font color="#586e75">"blah.txt"</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
<a name="line-2"></a>  <font color="#dccf8f">{</font><font color="#dccf8f">blah</font><font color="#dccf8f">.</font><font color="#dccf8f">txt</font> <font color="#dccf8f">open</font><font color="#dccf8f">}</font>
<a name="line-3"></a>  <font color="#586e75">"file contents!"</font>
<a name="line-4"></a>  <font color="#dccf8f">{</font><font color="#dccf8f">blah</font><font color="#dccf8f">.</font><font color="#dccf8f">txt</font> <font color="#dccf8f">closed</font><font color="#dccf8f">}</font>
</pre></div></section><section class="subsect"><div>Pipes can handle resource acquisition and release (via pipes-safe)</div><div><pre><a name="line-1"></a>  <font color="#586e75"><i>-- can be run from within a Proxy, finalizes without exiting.</i></font>
<a name="line-2"></a>  <font color="#586e75"><i>-- mnemonic, P stands for Proxy</i></font>
<a name="line-3"></a>  <font color="#dccf8f">runSafeP</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">MonadMask</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Effect</font> <font color="#dccf8f">(</font><font color="#b58900">SafeT</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Effect'</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-4"></a>
<a name="line-5"></a>  <font color="#586e75"><i>-- same as before</i></font>
<a name="line-6"></a>  <font color="#dccf8f">readFileExample</font> <font color="#b64926">::</font> <font color="#b58900">FilePath</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#b58900">String</font> <font color="#dccf8f">(</font><font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#b58900">SafeT</font> <font color="#b58900">IO</font><font color="#dccf8f">)</font> <font color="#b58900">()</font>
<a name="line-7"></a>
<a name="line-8"></a>  <font color="#dccf8f">writeOutputExample</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-9"></a>  <font color="#dccf8f">writeOutputExample</font> <font color="#b64926">=</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-10"></a>    <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">runSafeP</font> <font color="#dccf8f">$</font> <font color="#dccf8f">(</font><font color="#dccf8f">readFileExample</font> <font color="#586e75">"blah.txt"</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
<a name="line-11"></a>    <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">runSafeP</font> <font color="#dccf8f">$</font> <font color="#dccf8f">(</font><font color="#dccf8f">readFileExample</font> <font color="#586e75">"blah2.txt"</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
</pre></div></section><section class="subsect"><div>Pipes can handle resource acquisition and release (via pipes-safe)</div><div><pre><a name="line-1"></a>  <font color="#586e75"><i>-- can be run from within a Proxy, finalizes without exiting.</i></font>
<a name="line-2"></a>  <font color="#586e75"><i>-- mnemonic, P stands for Proxy</i></font>
<a name="line-3"></a>  <font color="#dccf8f">runSafeP</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">MonadMask</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Effect</font> <font color="#dccf8f">(</font><font color="#b58900">SafeT</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Effect'</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> 
<a name="line-4"></a>
<a name="line-5"></a>  <font color="#586e75"><i>-- same as before</i></font>
<a name="line-6"></a>  <font color="#dccf8f">readFileExample</font> <font color="#b64926">::</font> <font color="#b58900">FilePath</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer'</font> <font color="#b58900">String</font> <font color="#dccf8f">(</font><font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#b58900">SafeT</font> <font color="#b58900">IO</font><font color="#dccf8f">)</font> <font color="#b58900">()</font>
<a name="line-7"></a>
<a name="line-8"></a>  <font color="#dccf8f">writeOutputExample</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-9"></a>  <font color="#dccf8f">writeOutputExample</font> <font color="#b64926">=</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-10"></a>    <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">runSafeP</font> <font color="#dccf8f">$</font> <font color="#dccf8f">(</font><font color="#dccf8f">readFileExample</font> <font color="#586e75">"blah.txt"</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
<a name="line-11"></a>    <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">runSafeP</font> <font color="#dccf8f">$</font> <font color="#dccf8f">(</font><font color="#dccf8f">readFileExample</font> <font color="#586e75">"blah2.txt"</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font>
</pre></div><div><pre><a name="line-1"></a>  <font color="#dccf8f">&gt;</font><font color="#dccf8f">writeOutputExample</font> 
<a name="line-2"></a>  <font color="#dccf8f">{</font><font color="#dccf8f">blah</font><font color="#dccf8f">.</font><font color="#dccf8f">txt</font> <font color="#dccf8f">open</font><font color="#dccf8f">}</font>
<a name="line-3"></a>  <font color="#586e75">"file contents!"</font>
<a name="line-4"></a>  <font color="#dccf8f">{</font><font color="#dccf8f">blah</font><font color="#dccf8f">.</font><font color="#dccf8f">txt</font> <font color="#dccf8f">closed</font><font color="#dccf8f">}</font>
<a name="line-5"></a>  <font color="#dccf8f">{</font><font color="#dccf8f">blah2</font><font color="#dccf8f">.</font><font color="#dccf8f">txt</font> <font color="#dccf8f">open</font><font color="#dccf8f">}</font>
<a name="line-6"></a>  <font color="#586e75">"blah2 contents!"</font>
<a name="line-7"></a>  <font color="#dccf8f">{</font><font color="#dccf8f">blah2</font><font color="#dccf8f">.</font><font color="#dccf8f">txt</font> <font color="#dccf8f">closed</font><font color="#dccf8f">}</font>
</pre></div></section><section class="subsect"><div>Pipes has a full suite of error handling <pre><a name="line-1"></a><a name="MonadSafe"></a><font color="#b64926">class</font> <font color="#dccf8f">(</font><font color="#b58900">MonadCatch</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">MonadMask</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">MonadIO</font> <font color="#dccf8f">(</font><font color="#b58900">Base</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font> <font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font>
<a name="line-2"></a>  <font color="#b64926">type</font> <font color="#b58900">Base</font> <font color="#dccf8f">(</font><font color="#dccf8f">m</font> <font color="#b64926">::</font> <font color="#dccf8f">*</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">*</font><font color="#dccf8f">)</font> <font color="#b64926">::</font> <font color="#dccf8f">*</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">*</font>
<a name="line-3"></a>
<a name="line-4"></a><a name="instance%20MonadSafe%20(Proxy%20a'%20a%20b'%20b%20m)"></a><font color="#b64926">instance</font> <font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">MonadSafe</font> <font color="#dccf8f">(</font><font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font>
<a name="line-5"></a> <font color="#b64926">type</font> <font color="#b58900">Base</font> <font color="#dccf8f">(</font><font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#b64926">::</font> <font color="#dccf8f">*</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">*</font><font color="#dccf8f">)</font> <font color="#b64926">::</font> <font color="#dccf8f">*</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">*</font>
<a name="line-6"></a>
<a name="line-7"></a>
<a name="line-8"></a><a name="onException"></a><font color="#dccf8f">onException</font> <font color="#b64926">::</font> <font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Base</font> <font color="#dccf8f">m</font> <font color="#dccf8f">b</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font>
<a name="line-9"></a>
<a name="line-10"></a><a name="tryP"></a><font color="#586e75"><i>-- On exception, Pipe ends cleany with a (Left exception)</i></font>
<a name="line-11"></a><font color="#586e75"><i>-- NOTE: catchP and tryP are in pipes-safe 2.2.5 which hasn't hit lts yet.</i></font>
<a name="line-12"></a><font color="#dccf8f">tryP</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">Exception</font> <font color="#dccf8f">e</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font>
<a name="line-13"></a>  <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Either</font> <font color="#dccf8f">e</font> <font color="#dccf8f">r</font><font color="#dccf8f">)</font>
<a name="line-14"></a><a name="catchP"></a><font color="#dccf8f">catchP</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">Exception</font> <font color="#dccf8f">e</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font>
<a name="line-15"></a>  <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">e</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-16"></a>
<a name="line-17"></a><a name="finally"></a><font color="#dccf8f">finally</font> <font color="#b64926">::</font> <font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Base</font> <font color="#dccf8f">m</font> <font color="#dccf8f">b</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font>
<a name="line-18"></a>
<a name="line-19"></a><a name="bracket"></a><font color="#dccf8f">bracket</font> <font color="#b64926">::</font> <font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Base</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Base</font> <font color="#dccf8f">m</font> <font color="#dccf8f">b</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">c</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">c</font>
<a name="line-20"></a><a name="bracket_"></a><font color="#dccf8f">bracket_</font> <font color="#b64926">::</font> <font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Base</font> <font color="#dccf8f">m</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Base</font> <font color="#dccf8f">m</font> <font color="#dccf8f">b</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">c</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">c</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>pipes-async (uses pipes-safe)</div></section><section class="subsect"><div>pipes-async exports only two functions<pre><a name="line-1"></a>  <font color="#dccf8f">buffer</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">MonadBaseControl</font> <font color="#b58900">IO</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">MonadBaseControl</font> <font color="#b58900">IO</font> <font color="#dccf8f">(</font><font color="#b58900">Base</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font><font color="#dccf8f">,</font> <font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font>
<a name="line-2"></a>  <font color="#b58900">Int</font> <font color="#b64926">-&gt;</font>
<a name="line-3"></a>  <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font>
<a name="line-4"></a>  <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> <font color="#dccf8f">c'</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font>
<a name="line-5"></a>  <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">c'</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-6"></a>
<a name="line-7"></a>  <font color="#586e75"><i>-- very similar type to &gt;-&gt;</i></font>
<a name="line-8"></a>  <font color="#dccf8f">&gt;&amp;&gt;</font> <font color="#b64926">=</font> <font color="#dccf8f">buffer</font> <font color="#586e75">16</font>
</pre></div></section><section class="subsect"><div>pipes-async exports only two functions<pre><a name="line-1"></a>  <font color="#dccf8f">buffer</font> <font color="#b64926">::</font> <font color="#dccf8f">(</font><font color="#b58900">MonadBaseControl</font> <font color="#b58900">IO</font> <font color="#dccf8f">m</font><font color="#dccf8f">,</font> <font color="#b58900">MonadBaseControl</font> <font color="#b58900">IO</font> <font color="#dccf8f">(</font><font color="#b58900">Base</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font><font color="#dccf8f">,</font> <font color="#b58900">MonadSafe</font> <font color="#dccf8f">m</font><font color="#dccf8f">)</font> <font color="#b64926">=&gt;</font>
<a name="line-2"></a>  <font color="#b58900">Int</font> <font color="#b64926">-&gt;</font>
<a name="line-3"></a>  <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font>
<a name="line-4"></a>  <font color="#b58900">Proxy</font> <font color="#b58900">()</font> <font color="#dccf8f">b</font> <font color="#dccf8f">c'</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font>
<a name="line-5"></a>  <font color="#b58900">Proxy</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">c'</font> <font color="#dccf8f">c</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-6"></a>
<a name="line-7"></a>  <font color="#586e75"><i>-- very similar type to &gt;-&gt;</i></font>
<a name="line-8"></a>  <font color="#dccf8f">&gt;&amp;&gt;</font> <font color="#b64926">=</font> <font color="#dccf8f">buffer</font> <font color="#586e75">16</font>
</pre></div><div><pre><a name="line-1"></a>  <font color="#586e75"><i>-- a single threaded program</i></font>
<a name="line-2"></a>  <font color="#dccf8f">runSafeT</font> <font color="#dccf8f">$</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">readFile</font> <font color="#586e75">"input.txt"</font> <font color="#dccf8f">&gt;-&gt;</font>
<a name="line-3"></a>    <font color="#dccf8f">doSomethingCheap</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">doSomethingExpensiveAgain</font> <font color="#dccf8f">&gt;-&gt;</font>
<a name="line-4"></a>    <font color="#dccf8f">writeFile</font> <font color="#586e75">"output.txt"</font>
<a name="line-5"></a>
<a name="line-6"></a>  <font color="#586e75"><i>-- a concurrent program that does the exact same thing (ignoring interleaved IO effects)</i></font>
<a name="line-7"></a>  <font color="#dccf8f">runSafeT</font> <font color="#dccf8f">$</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">readFile</font> <font color="#586e75">"input.txt"</font> <font color="#dccf8f">&gt;-&gt;</font>
<a name="line-8"></a>    <font color="#dccf8f">doSomethingCheap</font> <font color="#dccf8f">&gt;&amp;&gt;</font> <font color="#dccf8f">doSomethingExpensiveAgain</font> <font color="#dccf8f">&gt;-&gt;</font>
<a name="line-9"></a>    <font color="#dccf8f">writeFile</font> <font color="#586e75">"output.txt"</font>
</pre></div></section><section class="subsect"><div>Note that that pipes are associative</div></section><section class="subsect"><div>Note that that pipes are associative</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">x</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">y</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">z</font><font color="#dccf8f">)</font>
<a name="line-2"></a>  <font color="#586e75"><i>-- is equivalent to</i></font>
<a name="line-3"></a>  <font color="#dccf8f">(</font><font color="#dccf8f">x</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">y</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">z</font>
</pre></div></section><section class="subsect"><div>Note that that pipes are associative</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">x</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">y</font> <font color="#dccf8f">&gt;&amp;&gt;</font> <font color="#dccf8f">z</font><font color="#dccf8f">)</font>
<a name="line-2"></a>  <font color="#586e75"><i>-- is almost equivalent to, but the concurrency</i></font>
<a name="line-3"></a>  <font color="#586e75"><i>-- occurs differently.</i></font>
<a name="line-4"></a>  <font color="#dccf8f">(</font><font color="#dccf8f">x</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">y</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;&amp;&gt;</font> <font color="#dccf8f">z</font>
</pre></div></section><section class="subsect"><div>Note that that pipes are associative</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">x</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">y</font> <font color="#dccf8f">&gt;&amp;&gt;</font> <font color="#dccf8f">z</font><font color="#dccf8f">)</font>
<a name="line-2"></a>  <font color="#586e75"><i>-- is almost equivalent to, but the concurrency</i></font>
<a name="line-3"></a>  <font color="#586e75"><i>-- occurs differently.</i></font>
<a name="line-4"></a>  <font color="#dccf8f">(</font><font color="#dccf8f">x</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">y</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;&amp;&gt;</font> <font color="#dccf8f">z</font>
</pre></div><div>pipes-async are not quite associative, technically.</div></section><section class="subsect"><div>Note that that pipes are associative</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">x</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">y</font> <font color="#dccf8f">&gt;&amp;&gt;</font> <font color="#dccf8f">z</font><font color="#dccf8f">)</font>
<a name="line-2"></a>  <font color="#586e75"><i>-- is almost equivalent to, but the concurrency</i></font>
<a name="line-3"></a>  <font color="#586e75"><i>-- occurs differently.</i></font>
<a name="line-4"></a>  <font color="#dccf8f">(</font><font color="#dccf8f">x</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">y</font><font color="#dccf8f">)</font> <font color="#dccf8f">&gt;&amp;&gt;</font> <font color="#dccf8f">z</font>
</pre></div><div>Still pretty cool (and useful!)</div></section></section><section class="sect"><section class="subsect"><div>process-streaming</div></section><section class="subsect"><div><pre><a name="line-1"></a><font color="#dccf8f">&gt;&gt;&gt;</font>
<a name="line-2"></a>  <font color="#586e75"><i>-- a complicated example (straight from docs) of what can be done.</i></font>
<a name="line-3"></a>  <font color="#dccf8f">test</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">ExitCode</font>
<a name="line-4"></a>  <font color="#dccf8f">test</font> <font color="#b64926">=</font> <font color="#dccf8f">execute</font> <font color="#dccf8f">(</font><font color="#dccf8f">piped</font> <font color="#dccf8f">(</font><font color="#dccf8f">shell</font> <font color="#586e75">"{ cat ; sleep 1 ; echo eee 1&gt;&amp;2 ; }"</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font> <font color="#dccf8f">$</font> 
<a name="line-5"></a>        <font color="#dccf8f">(</font><font color="#b64926">\</font><font color="#b64926">_</font> <font color="#b64926">_</font> <font color="#dccf8f">o</font> <font color="#dccf8f">e</font> <font color="#dccf8f">oe</font> <font color="#dccf8f">ec</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">o</font><font color="#dccf8f">,</font><font color="#dccf8f">e</font><font color="#dccf8f">,</font><font color="#dccf8f">oe</font><font color="#dccf8f">,</font><font color="#dccf8f">ec</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font> 
<a name="line-6"></a>        <font color="#dccf8f">&lt;$&gt;</font>
<a name="line-7"></a>        <font color="#dccf8f">feedBytes</font> <font color="#dccf8f">(</font><font color="#b58900">Just</font> <font color="#586e75">"aaa"</font><font color="#dccf8f">)</font> <font color="#586e75"><i>-- &lt;- first _</i></font>
<a name="line-8"></a>        <font color="#dccf8f">&lt;*&gt;</font> 
<a name="line-9"></a>        <font color="#dccf8f">feedBytes</font> <font color="#dccf8f">(</font><font color="#b58900">Just</font> <font color="#586e75">"bbb"</font><font color="#dccf8f">)</font> <font color="#586e75"><i>-- &lt;- second _</i></font>
<a name="line-10"></a>        <font color="#dccf8f">&lt;*&gt;</font> 
<a name="line-11"></a>        <font color="#dccf8f">foldOut</font> <font color="#dccf8f">intoLazyBytes</font>  <font color="#586e75"><i>-- &lt;- o (output)</i></font>
<a name="line-12"></a>        <font color="#dccf8f">&lt;*&gt;</font>
<a name="line-13"></a>        <font color="#dccf8f">foldErr</font> <font color="#dccf8f">intoLazyBytes</font>  <font color="#586e75"><i>-- &lt;- oe (output error)</i></font>
<a name="line-14"></a>        <font color="#dccf8f">&lt;*&gt;</font>
<a name="line-15"></a>        <font color="#dccf8f">foldOutErr</font> <font color="#dccf8f">(</font><font color="#dccf8f">combined</font> <font color="#dccf8f">(</font><font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">lines</font> <font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">utf8x</font><font color="#dccf8f">)</font> <font color="#dccf8f">(</font><font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">lines</font> <font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">utf8x</font><font color="#dccf8f">)</font> <font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">intoLazyText</font><font color="#dccf8f">)</font>
<a name="line-16"></a>        <font color="#586e75"><i>-- ^ ec -- output and error combined</i></font>
<a name="line-17"></a>        <font color="#586e75"><i>--           ^ combined - combines stdout and stderr</i></font>
<a name="line-18"></a>        <font color="#586e75"><i>--                      ^ PT.lines splits takes chunks text into lines</i></font>
<a name="line-19"></a>        <font color="#586e75"><i>--                              ^ PT.utf8x encodes bytestring into text</i></font>
<a name="line-20"></a>        <font color="#dccf8f">&lt;*&gt;</font>
<a name="line-21"></a>        <font color="#dccf8f">exitCode</font> <font color="#586e75"><i>-- &lt;- return the exit code instead of ()</i></font>
<a name="line-22"></a>
<a name="line-23"></a>  <font color="#dccf8f">&gt;</font> <font color="#dccf8f">test</font>
<a name="line-24"></a>  <font color="#dccf8f">(</font><font color="#586e75">"aaabbb"</font><font color="#dccf8f">,</font><font color="#586e75">"eee\n"</font><font color="#dccf8f">,</font><font color="#586e75">"aaabbb\neee\n"</font><font color="#dccf8f">,</font><font color="#b58900">ExitSuccess</font><font color="#dccf8f">)</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a><font color="#dccf8f">&gt;&gt;&gt;</font>
<a name="line-2"></a>  <font color="#586e75"><i>-- a complicated example (straight from docs) of what can be done.</i></font>
<a name="line-3"></a>  <font color="#dccf8f">test</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">ExitCode</font>
<a name="line-4"></a>  <font color="#dccf8f">test</font> <font color="#b64926">=</font> <font color="#dccf8f">execute</font> <font color="#dccf8f">(</font><font color="#dccf8f">piped</font> <font color="#dccf8f">(</font><font color="#dccf8f">shell</font> <font color="#586e75">"{ cat ; sleep 1 ; echo eee 1&gt;&amp;2 ; }"</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font> <font color="#dccf8f">$</font> 
<a name="line-5"></a>        <font color="#dccf8f">(</font><font color="#b64926">\</font><font color="#b64926">_</font> <font color="#b64926">_</font> <font color="#dccf8f">o</font> <font color="#dccf8f">e</font> <font color="#dccf8f">oe</font> <font color="#dccf8f">ec</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">o</font><font color="#dccf8f">,</font><font color="#dccf8f">e</font><font color="#dccf8f">,</font><font color="#dccf8f">oe</font><font color="#dccf8f">,</font><font color="#dccf8f">ec</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font> 
<a name="line-6"></a>        <font color="#dccf8f">&lt;$&gt;</font>
<a name="line-7"></a>        <font color="#dccf8f">feedBytes</font> <font color="#dccf8f">(</font><font color="#b58900">Just</font> <font color="#586e75">"aaa"</font><font color="#dccf8f">)</font> <font color="#586e75"><i>-- &lt;- first _</i></font>
<a name="line-8"></a>        <font color="#dccf8f">&lt;*&gt;</font> 
<a name="line-9"></a>        <font color="#dccf8f">feedBytes</font> <font color="#dccf8f">(</font><font color="#b58900">Just</font> <font color="#586e75">"bbb"</font><font color="#dccf8f">)</font> <font color="#586e75"><i>-- &lt;- second _</i></font>
<a name="line-10"></a>        <font color="#dccf8f">&lt;*&gt;</font> 
<a name="line-11"></a>        <font color="#dccf8f">foldOut</font> <font color="#dccf8f">intoLazyBytes</font>  <font color="#586e75"><i>-- &lt;- o (output)</i></font>
<a name="line-12"></a>        <font color="#dccf8f">&lt;*&gt;</font>
<a name="line-13"></a>        <font color="#dccf8f">foldErr</font> <font color="#dccf8f">intoLazyBytes</font>  <font color="#586e75"><i>-- &lt;- oe (output error)</i></font>
<a name="line-14"></a>        <font color="#dccf8f">&lt;*&gt;</font>
<a name="line-15"></a>        <font color="#dccf8f">foldOutErr</font> <font color="#dccf8f">(</font><font color="#dccf8f">combined</font> <font color="#dccf8f">(</font><font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">lines</font> <font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">utf8x</font><font color="#dccf8f">)</font> <font color="#dccf8f">(</font><font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">lines</font> <font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">utf8x</font><font color="#dccf8f">)</font> <font color="#b58900">PT</font><font color="#dccf8f">.</font><font color="#dccf8f">intoLazyText</font><font color="#dccf8f">)</font>
<a name="line-16"></a>        <font color="#586e75"><i>-- ^ ec -- output and error combined</i></font>
<a name="line-17"></a>        <font color="#586e75"><i>--           ^ combined - combines stdout and stderr</i></font>
<a name="line-18"></a>        <font color="#586e75"><i>--                      ^ PT.lines splits takes chunks text into lines</i></font>
<a name="line-19"></a>        <font color="#586e75"><i>--                              ^ PT.utf8x encodes bytestring into text</i></font>
<a name="line-20"></a>        <font color="#dccf8f">&lt;*&gt;</font>
<a name="line-21"></a>        <font color="#dccf8f">exitCode</font> <font color="#586e75"><i>-- &lt;- return the exit code instead of ()</i></font>
<a name="line-22"></a>
<a name="line-23"></a>  <font color="#dccf8f">&gt;</font> <font color="#dccf8f">test</font>
<a name="line-24"></a>  <font color="#dccf8f">(</font><font color="#586e75">"aaabbb"</font><font color="#dccf8f">,</font><font color="#586e75">"eee\n"</font><font color="#dccf8f">,</font><font color="#586e75">"aaabbb\neee\n"</font><font color="#dccf8f">,</font><font color="#b58900">ExitSuccess</font><font color="#dccf8f">)</font>
</pre></div><div>This library has a ton of flexibility</div></section><section class="subsect"><div>Here&#39;s an example of something I&#39;ve personally done with it<pre><a name="line-1"></a>  <font color="#b64926">import</font> <font color="#b58900">System</font><font color="#dccf8f">.</font><font color="#b58900">Process</font><font color="#dccf8f">.</font><font color="#b58900">Streaming</font> <font color="#b64926">as</font> <font color="#b58900">PS</font>
<a name="line-2"></a>
<a name="line-3"></a>  <font color="#dccf8f">lsServer</font> <font color="#b64926">::</font> <font color="#b58900">Producer</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#b58900">ByteString</font> <font color="#b58900">IO</font> <font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Consumer</font> <font color="#b58900">B</font><font color="#dccf8f">.</font><font color="#b58900">ByteString</font> <font color="#b58900">IO</font> <font color="#b58900">()</font>
<a name="line-4"></a>              <font color="#b64926">-&gt;</font> <font color="#b58900">IO</font> <font color="#b58900">ExitCode</font>
<a name="line-5"></a>  <font color="#dccf8f">lsServer</font> <font color="#dccf8f">prod</font> <font color="#dccf8f">cons</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-6"></a>    <font color="#b64926">let</font> <font color="#dccf8f">cmd</font> <font color="#b64926">=</font> <font color="#dccf8f">shell</font> <font color="#586e75">"telnet server.com"</font>
<a name="line-7"></a>    <font color="#dccf8f">execute</font> <font color="#dccf8f">(</font><font color="#dccf8f">piped</font> <font color="#dccf8f">cmd</font><font color="#dccf8f">)</font> <font color="#dccf8f">(</font><font color="#b58900">PS</font><font color="#dccf8f">.</font><font color="#dccf8f">foldOut</font> <font color="#dccf8f">(</font><font color="#b58900">PS</font><font color="#dccf8f">.</font><font color="#dccf8f">withConsumer</font> <font color="#dccf8f">cons</font><font color="#dccf8f">)</font> <font color="#dccf8f">*&gt;</font> <font color="#b58900">PS</font><font color="#dccf8f">.</font><font color="#dccf8f">feedProducer</font> <font color="#dccf8f">prod</font> <font color="#dccf8f">*&gt;</font> <font color="#dccf8f">exitCode</font><font color="#dccf8f">)</font>
<a name="line-8"></a>
<a name="line-9"></a>  <font color="#dccf8f">main</font> <font color="#b64926">::</font> <font color="#b58900">IO</font> <font color="#b58900">ExitCode</font>
<a name="line-10"></a>  <font color="#dccf8f">main</font> <font color="#b64926">=</font> <font color="#dccf8f">lsServer</font> <font color="#dccf8f">(</font><font color="#dccf8f">yield</font> <font color="#586e75">"somecommand\n"</font><font color="#dccf8f">)</font> <font color="#dccf8f">(</font><font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#dccf8f">await</font> <font color="#dccf8f">&gt;&gt;=</font> <font color="#dccf8f">lift</font> <font color="#dccf8f">.</font> <font color="#dccf8f">print</font><font color="#dccf8f">)</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>pipes-parse</div></section><section class="subsect"><div>Representing a parser as a consumer seems like a reasonable idea<pre><a name="line-1"></a>  <font color="#dccf8f">someText</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Producer</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
<a name="line-2"></a>
<a name="line-3"></a>  <font color="#dccf8f">parseHelloWorld</font> <font color="#b64926">::</font> <font color="#b64926">forall</font> <font color="#dccf8f">m</font><font color="#dccf8f">.</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#dccf8f">(</font><font color="#b58900">String</font><font color="#dccf8f">,</font> <font color="#b58900">String</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font>
<a name="line-4"></a>  <font color="#dccf8f">parseHelloWorld</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-5"></a>    <font color="#dccf8f">hello</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">parseString</font> <font color="#586e75">"hello"</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#b58900">String</font><font color="#dccf8f">)</font>
<a name="line-6"></a>    <font color="#dccf8f">world</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">parseString</font> <font color="#586e75">"world"</font> <font color="#b64926">::</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#b58900">String</font><font color="#dccf8f">)</font>
<a name="line-7"></a>    <font color="#dccf8f">return</font> <font color="#dccf8f">(</font><font color="#b58900">(,)</font> <font color="#dccf8f">&lt;$&gt;</font> <font color="#dccf8f">hello</font> <font color="#dccf8f">&lt;*&gt;</font> <font color="#dccf8f">world</font><font color="#dccf8f">)</font>
<a name="line-8"></a>
<a name="line-9"></a>  <font color="#dccf8f">test</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#dccf8f">(</font><font color="#b58900">String</font><font color="#dccf8f">,</font> <font color="#b58900">String</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font>
<a name="line-10"></a>  <font color="#dccf8f">test</font> <font color="#b64926">=</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">someText</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">parseHelloWorld</font>
</pre></div></section><section class="subsect"><div>Until you actually try to implement it<pre><a name="line-1"></a>  <font color="#dccf8f">parseString</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#b58900">String</font><font color="#dccf8f">)</font>
<a name="line-2"></a>  <font color="#dccf8f">parseString</font> <font color="#dccf8f">str</font> <font color="#b64926">=</font> <font color="#dccf8f">loop</font> <font color="#586e75">""</font>
<a name="line-3"></a>
<a name="line-4"></a>    <font color="#b64926">where</font>
<a name="line-5"></a>      <font color="#dccf8f">loop</font> <font color="#dccf8f">accum</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-6"></a>        <font color="#dccf8f">chunk</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">await</font>
<a name="line-7"></a>        <font color="#b64926">let</font> <font color="#dccf8f">sofar</font> <font color="#b64926">=</font> <font color="#dccf8f">accum</font> <font color="#dccf8f">++</font> <font color="#dccf8f">chunk</font>
<a name="line-8"></a>
<a name="line-9"></a>        <font color="#586e75"><i>-- do we have enough text yet?</i></font>
<a name="line-10"></a>        <font color="#b64926">if</font> <font color="#dccf8f">(</font><font color="#dccf8f">length</font> <font color="#dccf8f">str</font> <font color="#dccf8f">&gt;</font> <font color="#dccf8f">length</font> <font color="#dccf8f">sofar</font><font color="#dccf8f">)</font>
<a name="line-11"></a>          <font color="#b64926">then</font> <font color="#dccf8f">loop</font> <font color="#dccf8f">sofar</font> <font color="#586e75"><i>-- no, await more text</i></font>
<a name="line-12"></a>
<a name="line-13"></a>          <font color="#586e75"><i>-- yes, test what we have with what we are looking for</i></font>
<a name="line-14"></a>          <font color="#b64926">else</font> <font color="#b64926">if</font> <font color="#dccf8f">take</font> <font color="#dccf8f">(</font><font color="#dccf8f">length</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font> <font color="#dccf8f">sofar</font> <font color="#dccf8f">==</font> <font color="#dccf8f">str</font>
<a name="line-15"></a>
<a name="line-16"></a>            <font color="#b64926">then</font> <font color="#b64926">do</font>
<a name="line-17"></a>              <font color="#586e75"><i>-- what do we do with all the extra text we took?</i></font>
<a name="line-18"></a>              <font color="#dccf8f">giveBackToProducer</font> <font color="#dccf8f">$</font> <font color="#dccf8f">drop</font> <font color="#dccf8f">(</font><font color="#dccf8f">length</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font> <font color="#dccf8f">sofar</font>
<a name="line-19"></a>              <font color="#dccf8f">return</font> <font color="#dccf8f">(</font><font color="#b58900">Just</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font>
<a name="line-20"></a>            <font color="#b64926">else</font> <font color="#b64926">do</font>
<a name="line-21"></a>              <font color="#586e75"><i>-- what if we entirely failed?</i></font>
<a name="line-22"></a>              <font color="#dccf8f">giveBackToProducer</font> <font color="#dccf8f">sofar</font>
<a name="line-23"></a>              <font color="#dccf8f">return</font> <font color="#b58900">Nothing</font>
<a name="line-24"></a>
<a name="line-25"></a>      <font color="#dccf8f">giveBackToProducer</font> <font color="#b64926">=</font> <font color="#dccf8f">undefined</font>
</pre></div></section><section class="subsect"><div>Conduits calls this the &#39;leftover&#39; problem, deals with it on the type level<pre><a name="line-1"></a>  <font color="#586e75"><i>-- Essentially, adds leftover type to its consumer</i></font>
<a name="line-2"></a>  <font color="#b58900">Pipe</font> <font color="#dccf8f">i</font> <font color="#dccf8f">o</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Pipe</font> <font color="#dccf8f">l</font> <font color="#dccf8f">i</font> <font color="#dccf8f">o</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
<a name="line-3"></a>
<a name="line-4"></a>  <font color="#586e75"><i>-- But with pipes being bidirectional, you'd end up with something like</i></font>
<a name="line-5"></a>  <font color="#b64926">data</font> <font color="#b58900">Proxy</font> <font color="#dccf8f">l1</font> <font color="#dccf8f">l2</font> <font color="#dccf8f">a'</font> <font color="#dccf8f">a</font> <font color="#dccf8f">b'</font> <font color="#dccf8f">b</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div>What you really need to do is save the current state of the producer<pre><a name="line-1"></a>  <font color="#b64926">type</font> <font color="#b58900">Parser</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">=</font> <font color="#b58900">StateT</font> <font color="#dccf8f">(</font><font color="#b58900">Producer</font> <font color="#dccf8f">a</font><font color="#dccf8f">)</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#b64926">type</font> <font color="#b58900">Parser</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">=</font> <font color="#b58900">StateT</font> <font color="#dccf8f">(</font><font color="#b58900">Producer</font> <font color="#dccf8f">a</font><font color="#dccf8f">)</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre><pre><a name="line-1"></a>  <font color="#b64926">import</font> <font color="#b58900">Control</font><font color="#dccf8f">.</font><font color="#b58900">Monad</font><font color="#dccf8f">.</font><font color="#b58900">State</font> <font color="#b64926">as</font> <font color="#b58900">S</font>
<a name="line-2"></a>
<a name="line-3"></a>  <font color="#dccf8f">draw</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">Parser</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#dccf8f">a</font><font color="#dccf8f">)</font>
<a name="line-4"></a>  <font color="#dccf8f">draw</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-5"></a>      <font color="#dccf8f">p</font> <font color="#b64926">&lt;-</font> <font color="#b58900">S</font><font color="#dccf8f">.</font><font color="#dccf8f">get</font>
<a name="line-6"></a>      <font color="#dccf8f">x</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">lift</font> <font color="#dccf8f">(</font><font color="#dccf8f">next</font> <font color="#dccf8f">p</font><font color="#dccf8f">)</font>
<a name="line-7"></a>      <font color="#b64926">case</font> <font color="#dccf8f">x</font> <font color="#b64926">of</font>
<a name="line-8"></a>          <font color="#b58900">Left</font>   <font color="#dccf8f">r</font>      <font color="#b64926">-&gt;</font> <font color="#b64926">do</font>
<a name="line-9"></a>              <font color="#b58900">S</font><font color="#dccf8f">.</font><font color="#dccf8f">put</font> <font color="#dccf8f">(</font><font color="#dccf8f">return</font> <font color="#dccf8f">r</font><font color="#dccf8f">)</font>
<a name="line-10"></a>              <font color="#dccf8f">return</font> <font color="#b58900">Nothing</font>
<a name="line-11"></a>          <font color="#b58900">Right</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font><font color="#dccf8f">,</font> <font color="#dccf8f">p'</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#b64926">do</font>
<a name="line-12"></a>              <font color="#b58900">S</font><font color="#dccf8f">.</font><font color="#dccf8f">put</font> <font color="#dccf8f">p'</font>
<a name="line-13"></a>              <font color="#dccf8f">return</font> <font color="#dccf8f">(</font><font color="#b58900">Just</font> <font color="#dccf8f">a</font><font color="#dccf8f">)</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#b64926">type</font> <font color="#b58900">Parser</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">=</font> <font color="#b58900">StateT</font> <font color="#dccf8f">(</font><font color="#b58900">Producer</font> <font color="#dccf8f">a</font><font color="#dccf8f">)</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre><pre><a name="line-1"></a>  <font color="#dccf8f">unDraw</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Parser</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#b58900">()</font>
<a name="line-2"></a>  <font color="#dccf8f">unDraw</font> <font color="#dccf8f">a</font> <font color="#b64926">=</font> <font color="#b58900">S</font><font color="#dccf8f">.</font><font color="#dccf8f">modify</font> <font color="#dccf8f">(</font><font color="#dccf8f">yield</font> <font color="#dccf8f">a</font> <font color="#dccf8f">&gt;&gt;</font><font color="#dccf8f">)</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#b64926">type</font> <font color="#b58900">Parser</font> <font color="#dccf8f">a</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font> <font color="#b64926">=</font> <font color="#b58900">StateT</font> <font color="#dccf8f">(</font><font color="#b58900">Producer</font> <font color="#dccf8f">a</font><font color="#dccf8f">)</font> <font color="#dccf8f">m</font> <font color="#dccf8f">r</font>
</pre><pre><a name="line-1"></a>  <font color="#dccf8f">parseString</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Parser</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#b58900">String</font><font color="#dccf8f">)</font>
<a name="line-2"></a>  <font color="#dccf8f">parseString</font> <font color="#dccf8f">str</font> <font color="#b64926">=</font> <font color="#dccf8f">loop</font> <font color="#586e75">""</font>
<a name="line-3"></a>    <font color="#b64926">where</font>
<a name="line-4"></a>      <font color="#dccf8f">loop</font> <font color="#dccf8f">accum</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-5"></a>        <font color="#dccf8f">chunk</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">draw</font> <font color="#586e75"><i>-- :: Parser (Maybe String)</i></font>
<a name="line-6"></a>        <font color="#b64926">case</font> <font color="#dccf8f">chunk</font> <font color="#b64926">of</font>
<a name="line-7"></a>          <font color="#b58900">Nothing</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">return</font> <font color="#b58900">Nothing</font>
<a name="line-8"></a>          <font color="#b58900">Just</font> <font color="#dccf8f">chunk'</font> <font color="#b64926">-&gt;</font> <font color="#b64926">do</font>
<a name="line-9"></a>            <font color="#b64926">let</font> <font color="#dccf8f">sofar</font> <font color="#b64926">=</font> <font color="#dccf8f">accum</font> <font color="#dccf8f">++</font> <font color="#dccf8f">chunk'</font>
<a name="line-10"></a>
<a name="line-11"></a>            <font color="#586e75"><i>-- do we have enough text yet?</i></font>
<a name="line-12"></a>            <font color="#b64926">if</font> <font color="#dccf8f">(</font><font color="#dccf8f">length</font> <font color="#dccf8f">str</font> <font color="#dccf8f">&gt;</font> <font color="#dccf8f">length</font> <font color="#dccf8f">sofar</font><font color="#dccf8f">)</font>
<a name="line-13"></a>              <font color="#b64926">then</font> <font color="#dccf8f">loop</font> <font color="#dccf8f">sofar</font> <font color="#586e75"><i>-- no, await more text</i></font>
<a name="line-14"></a>
<a name="line-15"></a>              <font color="#586e75"><i>-- yes, test what we have with what we are looking for</i></font>
<a name="line-16"></a>              <font color="#b64926">else</font> <font color="#b64926">if</font> <font color="#dccf8f">take</font> <font color="#dccf8f">(</font><font color="#dccf8f">length</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font> <font color="#dccf8f">sofar</font> <font color="#dccf8f">==</font> <font color="#dccf8f">str</font>
<a name="line-17"></a>
<a name="line-18"></a>                <font color="#b64926">then</font> <font color="#b64926">do</font>
<a name="line-19"></a>                  <font color="#586e75"><i>-- what do we do with all the extra text we took?</i></font>
<a name="line-20"></a>                  <font color="#dccf8f">unDraw</font> <font color="#dccf8f">$</font> <font color="#dccf8f">drop</font> <font color="#dccf8f">(</font><font color="#dccf8f">length</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font> <font color="#dccf8f">sofar</font>
<a name="line-21"></a>                  <font color="#dccf8f">return</font> <font color="#dccf8f">(</font><font color="#b58900">Just</font> <font color="#dccf8f">str</font><font color="#dccf8f">)</font>
<a name="line-22"></a>                <font color="#b64926">else</font> <font color="#b64926">do</font>
<a name="line-23"></a>                  <font color="#586e75"><i>-- what if we entirely failed?</i></font>
<a name="line-24"></a>                  <font color="#dccf8f">unDraw</font> <font color="#dccf8f">sofar</font>
<a name="line-25"></a>                  <font color="#dccf8f">return</font> <font color="#b58900">Nothing</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#b64926">import</font> <font color="#b58900">Control</font><font color="#dccf8f">.</font><font color="#b58900">Monad</font><font color="#dccf8f">.</font><font color="#b58900">State</font>
<a name="line-2"></a>  <font color="#b64926">import</font> <font color="#b58900">Pipes</font><font color="#dccf8f">.</font><font color="#b58900">Prelude</font> <font color="#b64926">as</font> <font color="#b58900">P</font>
<a name="line-3"></a>
<a name="line-4"></a>  <font color="#586e75"><i>-- type Parser a m r = StateT (Producer a) m r</i></font>
<a name="line-5"></a>  <font color="#586e75"><i>-- runStateT :: StateT s m a -&gt; m (a,s)</i></font>
<a name="line-6"></a>  <font color="#586e75"><i>-- runStateT (undefined :: Parser a m r) :: m (a,s)</i></font>
<a name="line-7"></a>  <font color="#586e75"><i>-- parseString :: String -&gt; P.Parser String m (Maybe String)</i></font>
<a name="line-8"></a>
<a name="line-9"></a>  <font color="#dccf8f">parseHelloWorld</font> <font color="#b64926">::</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#b58900">Parser</font> <font color="#b58900">String</font> <font color="#dccf8f">m</font> <font color="#dccf8f">(</font><font color="#b58900">Maybe</font> <font color="#dccf8f">(</font><font color="#b58900">String</font><font color="#dccf8f">,</font> <font color="#b58900">String</font><font color="#dccf8f">)</font><font color="#dccf8f">)</font>
<a name="line-10"></a>  <font color="#dccf8f">parseHelloWorld</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-11"></a>    <font color="#dccf8f">hello</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">parseString</font> <font color="#586e75">"hello"</font>
<a name="line-12"></a>    <font color="#dccf8f">world</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">parseString</font> <font color="#586e75">"world"</font>
<a name="line-13"></a>    <font color="#dccf8f">return</font> <font color="#dccf8f">(</font><font color="#b58900">(,)</font> <font color="#dccf8f">&lt;$&gt;</font> <font color="#dccf8f">hello</font> <font color="#dccf8f">&lt;*&gt;</font> <font color="#dccf8f">world</font><font color="#dccf8f">)</font>
<a name="line-14"></a>
<a name="line-15"></a>  <font color="#dccf8f">testParse</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-16"></a>    <font color="#dccf8f">(</font><font color="#dccf8f">res</font><font color="#dccf8f">,</font> <font color="#dccf8f">rest</font><font color="#dccf8f">)</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">runStateT</font> <font color="#dccf8f">parseHelloWorld</font> <font color="#dccf8f">(</font><font color="#dccf8f">yield</font> <font color="#586e75">"helloworldblah"</font><font color="#dccf8f">)</font>
<a name="line-17"></a>    <font color="#dccf8f">print</font> <font color="#dccf8f">res</font>
<a name="line-18"></a>    <font color="#dccf8f">runEffect</font> <font color="#dccf8f">(</font><font color="#dccf8f">rest</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#b58900">P</font><font color="#dccf8f">.</font><font color="#dccf8f">print</font><font color="#dccf8f">)</font>
<a name="line-19"></a>
<a name="line-20"></a>  <font color="#dccf8f">&gt;</font><font color="#dccf8f">testParse</font>
<a name="line-21"></a>  <font color="#b58900">Just</font> <font color="#dccf8f">(</font><font color="#586e75">"hello"</font><font color="#dccf8f">,</font><font color="#586e75">"world"</font><font color="#dccf8f">)</font>
<a name="line-22"></a>  <font color="#586e75">"blah"</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>Who remembers how categories work?</div></section><section class="subsect"><div>Who remembers how categories work?</div><div>Remember that to be a category, you must have:</div></section><section class="subsect"><div>Who remembers how categories work?</div><div>Remember that to be a category, you must have:</div><div><li>left and right identity</li></div></section><section class="subsect"><div>Who remembers how categories work?</div><div>Remember that to be a category, you must have:</div><div><li>left and right identity</li></div><div><li>associativity</li></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">(</font><font color="#dccf8f">&gt;&gt;=</font><font color="#dccf8f">)</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">b</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">b</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">c</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">c</font>
<a name="line-2"></a>  <font color="#dccf8f">(</font><font color="#dccf8f">&gt;=&gt;</font><font color="#dccf8f">)</font> <font color="#b64926">::</font> <font color="#b58900">Monad</font> <font color="#dccf8f">m</font> <font color="#b64926">=&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">b</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">(</font><font color="#dccf8f">b</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">c</font><font color="#dccf8f">)</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">a</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">m</font> <font color="#dccf8f">c</font>
</pre><table width="100%"><tbody><tr><th>Left Identity</th><td>return &gt;=&gt; g</td><td>===</td><td>g</td></tr><tr><th>Right Identity</th><td>f &gt;=&gt; return</td><td>===</td><td>f</td></tr><tr><th>Associativity</th><td>(f &gt;=&gt; g) &gt;=&gt; h</td><td>===</td><td>f &gt;=&gt; (g &gt;=&gt; h)</td></tr></tbody></table></div></section><section class="subsect"><div><table width="100%"><thead><tr><th></th><th>Identity</th><th>Composition</th><th>Point-ful</th></tr></thead><tbody><tr><td>Respond</td><td>respond/yield</td><td>/&gt;/</td><td>//&gt;</td></tr><tr><td>Request</td><td>request/(await ())</td><td>\&gt;\</td><td>&gt;\\</td></tr><tr><td>Push</td><td>push</td><td>&gt;~&gt;</td><td>&gt;&gt;~</td></tr><tr><td>Pull</td><td>pull</td><td>&gt;+&gt;</td><td>+&gt;&gt;</td></tr><tr><td>Kleisli</td><td>return</td><td>&gt;=&gt;</td><td>&gt;&gt;=</td></tr></tbody></table></div></section><section class="subsect"><div>Kleisli<table width="100%"><tbody><tr><th>Left Identity</th><td>return &gt;=&gt; g</td><td>===</td><td>g</td></tr><tr><th>Right Identity</th><td>f &gt;=&gt; return</td><td>===</td><td>f</td></tr><tr><th>Associativity</th><td>(f &gt;=&gt; g) &gt;=&gt; h</td><td>===</td><td>f &gt;=&gt; (g &gt;=&gt; h)</td></tr></tbody></table>Pipes Pull<table width="100%"><tbody><tr><th>Left Identity</th><td>pull &gt;+&gt; g</td><td>===</td><td>g</td></tr><tr><th>Right Identity</th><td>f &gt;+&gt; pull </td><td>===</td><td>f</td></tr><tr><th>Associativity</th><td>(f &gt;+&gt; g) &gt;+&gt; h</td><td>===</td><td>f &gt;+&gt; (g &gt;+&gt; h)</td></tr></tbody></table></div></section><section class="subsect"><div>By default a unidirection pipe is pull based</div></section><section class="subsect"><div>By default a unidirection pipe is pull based</div><div><pre style="text-align: center">  <font color="#dccf8f">f</font> <font color="#dccf8f">(</font><font color="#dccf8f">&gt;-&gt;</font><font color="#dccf8f">)</font> <font color="#dccf8f">g</font> <font color="#b64926">=</font> <font color="#dccf8f">(</font><font color="#b64926">\</font><font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">f</font><font color="#dccf8f">)</font> <font color="#dccf8f">+&gt;&gt;</font> <font color="#dccf8f">g</font>
</pre></div></section><section class="subsect"><div>By default a unidirection pipe is pull based</div><div><pre style="text-align: center">  <font color="#dccf8f">f</font> <font color="#dccf8f">(</font><font color="#dccf8f">&gt;-&gt;</font><font color="#dccf8f">)</font> <font color="#dccf8f">g</font> <font color="#b64926">=</font> <font color="#dccf8f">(</font><font color="#b64926">\</font><font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">f</font><font color="#dccf8f">)</font> <font color="#dccf8f">+&gt;&gt;</font> <font color="#dccf8f">g</font>
</pre></div><div><pre><a name="line-1"></a>  <font color="#dccf8f">&gt;</font><font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">countLetters</font>
<a name="line-2"></a>  <font color="#dccf8f">countLetters</font>
<a name="line-3"></a>  <font color="#dccf8f">stdin</font>
<a name="line-4"></a>  <font color="#dccf8f">fdsa</font>
<a name="line-5"></a>  <font color="#586e75">4</font>
<a name="line-6"></a>  <font color="#dccf8f">countLetters</font>
<a name="line-7"></a>  <font color="#dccf8f">stdin</font>
<a name="line-8"></a>  <font color="#dccf8f">asdf</font>
<a name="line-9"></a>  <font color="#586e75">4</font>
<a name="line-10"></a>  <font color="#dccf8f">countLetters</font>
<a name="line-11"></a>  <font color="#dccf8f">stdin</font>
</pre></div></section><section class="subsect"><div>By default a unidirection pipe is pull based</div><div><pre style="text-align: center">  <font color="#dccf8f">f</font> <font color="#dccf8f">(</font><font color="#dccf8f">&gt;-&gt;</font><font color="#dccf8f">)</font> <font color="#dccf8f">g</font> <font color="#b64926">=</font> <font color="#dccf8f">(</font><font color="#b64926">\</font><font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">f</font><font color="#dccf8f">)</font> <font color="#dccf8f">+&gt;&gt;</font> <font color="#dccf8f">g</font>
</pre></div><div><table width="100%"><thead><tr><th></th><th>Identity</th><th>Composition</th><th>Point-ful</th></tr></thead><tbody><tr><td>Respond</td><td>respond/yield</td><td>/&gt;/</td><td>//&gt;</td></tr><tr><td>Request</td><td>request/(await ())</td><td>\&gt;\</td><td>&gt;\\</td></tr><tr><td>Push</td><td>push</td><td>&gt;~&gt;</td><td>&gt;&gt;~</td></tr><tr><td>Pull</td><td>pull</td><td>&gt;+&gt;</td><td>+&gt;&gt;</td></tr><tr><td>Kleisli</td><td>return</td><td>&gt;=&gt;</td><td>&gt;&gt;=</td></tr></tbody></table></div></section><section class="subsect"><div><pre><a name="line-1"></a>  <font color="#dccf8f">stdin</font> <font color="#b64926">::</font> <font color="#b58900">Producer'</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-2"></a>  <font color="#dccf8f">stdin</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">$</font> <font color="#dccf8f">putStrLn</font> <font color="#586e75">"stdin"</font>
<a name="line-4"></a>    <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">lift</font> <font color="#dccf8f">getLine</font>
<a name="line-5"></a>    <font color="#dccf8f">yield</font> <font color="#dccf8f">str</font>
<a name="line-6"></a>
<a name="line-7"></a>  <font color="#dccf8f">countLetters</font> <font color="#b64926">::</font> <font color="#b58900">Consumer'</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">r</font>
<a name="line-8"></a>  <font color="#dccf8f">countLetters</font> <font color="#b64926">=</font> <font color="#dccf8f">forever</font> <font color="#dccf8f">$</font> <font color="#b64926">do</font>
<a name="line-9"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">$</font> <font color="#dccf8f">putStrLn</font> <font color="#586e75">"countLetters"</font>
<a name="line-10"></a>    <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">await</font>
<a name="line-11"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">.</font> <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">.</font> <font color="#dccf8f">show</font> <font color="#dccf8f">.</font> <font color="#dccf8f">length</font> <font color="#dccf8f">$</font> <font color="#dccf8f">str</font>
<a name="line-12"></a>
<a name="line-13"></a>  <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">countLetters</font>
<a name="line-14"></a>  <font color="#dccf8f">f</font> <font color="#dccf8f">&gt;-&gt;</font> <font color="#dccf8f">g</font> <font color="#b64926">=</font> <font color="#dccf8f">(</font><font color="#b64926">\</font><font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">f</font><font color="#dccf8f">)</font> <font color="#dccf8f">+&gt;&gt;</font> <font color="#dccf8f">g</font>
<a name="line-15"></a>
<a name="line-16"></a>  <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">(</font><font color="#b64926">\</font><font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#dccf8f">stdin</font><font color="#dccf8f">)</font> <font color="#dccf8f">+&gt;&gt;</font> <font color="#dccf8f">countLetters</font>
</pre></div></section><section class="subsect"><div><pre><a name="line-1"></a> 
<a name="line-2"></a>  <font color="#dccf8f">stdin'</font> <font color="#b64926">::</font> <font color="#b58900">()</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Producer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">b</font>
<a name="line-3"></a>  <font color="#dccf8f">stdin'</font> <font color="#b58900">()</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-4"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">$</font> <font color="#dccf8f">putStrLn</font> <font color="#586e75">"stdin"</font>
<a name="line-5"></a>    <font color="#dccf8f">str</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">lift</font> <font color="#dccf8f">getLine</font>
<a name="line-6"></a>    <font color="#dccf8f">nil</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">respond</font> <font color="#dccf8f">str</font> <font color="#586e75"><i>-- yield str</i></font>
<a name="line-7"></a>    <font color="#dccf8f">stdin'</font> <font color="#dccf8f">nil</font>
<a name="line-8"></a>
<a name="line-9"></a>  <font color="#dccf8f">pullbasedpipe</font> <font color="#b64926">=</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">stdin'</font> <font color="#dccf8f">+&gt;&gt;</font> <font color="#dccf8f">countLetters</font>
</pre></div></section><section class="subsect"><div>How about push instead of pull?</div></section><section class="subsect"><div>How about push instead of pull?</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">countLetters'</font> <font color="#b64926">::</font> <font color="#b58900">String</font> <font color="#b64926">-&gt;</font> <font color="#b58900">Consumer</font> <font color="#b58900">String</font> <font color="#b58900">IO</font> <font color="#dccf8f">b</font>
<a name="line-2"></a>  <font color="#dccf8f">countLetters'</font> <font color="#dccf8f">str</font> <font color="#b64926">=</font> <font color="#b64926">do</font>
<a name="line-3"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">$</font> <font color="#dccf8f">putStrLn</font> <font color="#586e75">"countLetters"</font>
<a name="line-4"></a>    <font color="#dccf8f">lift</font> <font color="#dccf8f">.</font> <font color="#dccf8f">putStrLn</font> <font color="#dccf8f">.</font> <font color="#dccf8f">show</font> <font color="#dccf8f">.</font> <font color="#dccf8f">length</font> <font color="#dccf8f">$</font> <font color="#dccf8f">str</font>
<a name="line-5"></a>    <font color="#dccf8f">str'</font> <font color="#b64926">&lt;-</font> <font color="#dccf8f">request</font> <font color="#b58900">()</font> <font color="#586e75"><i>-- await</i></font>
<a name="line-6"></a>    <font color="#dccf8f">countLetters'</font> <font color="#dccf8f">str'</font>
<a name="line-7"></a>
<a name="line-8"></a>  <font color="#dccf8f">pushbasedpipe</font> <font color="#b64926">=</font> <font color="#dccf8f">runEffect</font> <font color="#dccf8f">$</font> <font color="#dccf8f">stdin</font> <font color="#dccf8f">&gt;&gt;~</font> <font color="#dccf8f">countLetters'</font>
</pre></div></section><section class="subsect"><div>How about push instead of pull?</div><div><pre><a name="line-1"></a>  <font color="#dccf8f">&gt;</font><font color="#dccf8f">pullbasedpipe</font> 
<a name="line-2"></a>  <font color="#dccf8f">countLetters</font>
<a name="line-3"></a>  <font color="#dccf8f">stdin</font>
<a name="line-4"></a>  <font color="#dccf8f">asdf</font>
<a name="line-5"></a>  <font color="#586e75">4</font>
<a name="line-6"></a>  <font color="#dccf8f">countLetters</font>
<a name="line-7"></a>  <font color="#dccf8f">stdin</font>
<a name="line-8"></a>  <font color="#dccf8f">...</font>
<a name="line-9"></a>
<a name="line-10"></a>  <font color="#dccf8f">&gt;</font><font color="#dccf8f">pushbasedpipe</font> 
<a name="line-11"></a>  <font color="#dccf8f">stdin</font>
<a name="line-12"></a>  <font color="#dccf8f">asdf</font>
<a name="line-13"></a>  <font color="#dccf8f">countLetters</font>
<a name="line-14"></a>  <font color="#586e75">4</font>
<a name="line-15"></a>  <font color="#dccf8f">stdin</font>
<a name="line-16"></a>  <font color="#dccf8f">fdsa</font>
<a name="line-17"></a>  <font color="#dccf8f">countLetters</font>
<a name="line-18"></a>  <font color="#586e75">4</font>
<a name="line-19"></a>  <font color="#dccf8f">stdin</font>
<a name="line-20"></a>  <font color="#dccf8f">...</font>
</pre></div></section></section><section class="sect"><section class="subsect"><div>Honorable mentions:</div></section><section class="subsect"><div>Honorable mentions:</div><div><li>pipes-concurrency - an absolutely brilliant concurrent message passing abstraction</li></div></section><section class="subsect"><div>Honorable mentions:</div><div><li>pipes-concurrency - an absolutely brilliant concurrent message passing abstraction</li></div><div><li>pipes-group - abstract over series&#39; of producers (lists of lists)</li></div></section><section class="subsect"><div>Honorable mentions:</div><div><li>pipes-concurrency - an absolutely brilliant concurrent message passing abstraction</li></div><div><li>pipes-group - abstract over series&#39; of producers (lists of lists)</li></div><div><li>pipes-text, pipes-bytestring - pipes specialized for text and bytestring</li></div></section><section class="subsect"><div>Honorable mentions:</div><div><li>pipes-concurrency - an absolutely brilliant concurrent message passing abstraction</li></div><div><li>pipes-group - abstract over series&#39; of producers (lists of lists)</li></div><div><li>pipes-text, pipes-bytestring - pipes specialized for text and bytestring</li></div><div><li>pipes-aeson - encode or decode json on the fly in your pipe</li></div></section><section class="subsect"><div>Honorable mentions:</div><div><li>pipes-concurrency - an absolutely brilliant concurrent message passing abstraction</li></div><div><li>pipes-group - abstract over series&#39; of producers (lists of lists)</li></div><div><li>pipes-text, pipes-bytestring - pipes specialized for text and bytestring</li></div><div><li>pipes-aeson - encode or decode json on the fly in your pipe</li></div><div><li>pipes-http - pipes interface for streaming http responses</li></div></section><section class="subsect"><div>Honorable mentions:</div><div><li>pipes-concurrency - an absolutely brilliant concurrent message passing abstraction</li></div><div><li>pipes-group - abstract over series&#39; of producers (lists of lists)</li></div><div><li>pipes-text, pipes-bytestring - pipes specialized for text and bytestring</li></div><div><li>pipes-aeson - encode or decode json on the fly in your pipe</li></div><div><li>pipes-http - pipes interface for streaming http responses</li></div><div><li>pipes-attoparsec - create a producer of parsed values from an attoparsec parser</li></div></section><section class="subsect"><div>Honorable mentions:</div><div><li>pipes-concurrency - an absolutely brilliant concurrent message passing abstraction</li></div><div><li>pipes-group - abstract over series&#39; of producers (lists of lists)</li></div><div><li>pipes-text, pipes-bytestring - pipes specialized for text and bytestring</li></div><div><li>pipes-aeson - encode or decode json on the fly in your pipe</li></div><div><li>pipes-http - pipes interface for streaming http responses</li></div><div><li>pipes-attoparsec - create a producer of parsed values from an attoparsec parser</li></div><div><li>streaming - an alternate to unidirectional pipes also an alternative for pipes-group</li></div></section><section class="subsect"><div>Honorable mentions:</div><div><li>pipes-concurrency - an absolutely brilliant concurrent message passing abstraction</li></div><div><li>pipes-group - abstract over series&#39; of producers (lists of lists)</li></div><div><li>pipes-text, pipes-bytestring - pipes specialized for text and bytestring</li></div><div><li>pipes-aeson - encode or decode json on the fly in your pipe</li></div><div><li>pipes-http - pipes interface for streaming http responses</li></div><div><li>pipes-attoparsec - create a producer of parsed values from an attoparsec parser</li></div><div><li>streaming - an alternate to unidirectional pipes also an alternative for pipes-group</li></div><div><li>and many more</li></div></section><section class="subsect"><div>Thank you</div></section><section class="subsect"><div><h1>Pipes</h1><h4 style="margin-bottom: 40px">Practical use of Gabriel Gonzales&#39;s pipes library and ecosystem</h4><div style="font-size: 50%">David McHealy (david.mchealy@gmail.com)</div><div style="font-size: 70%">View slides online at: </div><div style="font-size: 50%">https://mindreader.github.io/pipes-slides</div></div></section></section></div></div><script src="public/reveal.js-3.3.0/lib/js/head.min.js"></script><script src="public/reveal.js-3.3.0/js/reveal.js"></script><script>Reveal.initialize({ 'center': true, 'controls': true, 'dependencies': [{ 'condition': (function() { return !document.body.classList; }), 'src': "public\/reveal.js-3.3.0\/lib\/js\/classList.js" }, { 'condition': (function() { return !(!(document.querySelector("[data-markdown]"))); }), 'src': "public\/reveal.js-3.3.0\/plugin\/markdown\/marked.js" }, { 'async': true, 'callback': (function() { hljs.initHighlightingOnLoad(); }), 'src': "public\/highlight\/highlight.pack.js" }], 'history': true, 'keyboard': null, 'progress': true, 'transition': "none" });</script></body></html>